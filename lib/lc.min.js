!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).LC={})}(this,(function(e){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)};function n(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var r=function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function o(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))}function i(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}function s(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,u=i.length;s<u;s++,o++)r[o]=i[s];return r}var u=function(){function e(){}return Object.defineProperty(e,"isSet",{get:function(){return!!this._adapters},enumerable:!1,configurable:!0}),e.set=function(e){this._adapters&&console.warn("Adapters already set"),this._adapters=e,this._onSet.forEach((function(t){return t(e)}))},e.get=function(){if(!this._adapters)throw new Error("Adapters not set");return this._adapters},e.on=function(e,t){switch(e){case"set":this._onSet.push(t)}},e._onSet=[],e}();function a(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var c=1e3,h=60*c,d=60*h,l=24*d,p=7*l,f=365.25*l,y=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*f;case"weeks":case"week":case"w":return n*p;case"days":case"day":case"d":return n*l;case"hours":case"hour":case"hrs":case"hr":case"h":return n*d;case"minutes":case"minute":case"mins":case"min":case"m":return n*h;case"seconds":case"second":case"secs":case"sec":case"s":return n*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===n&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=l)return v(e,t,l,"day");if(t>=d)return v(e,t,d,"hour");if(t>=h)return v(e,t,h,"minute");if(t>=c)return v(e,t,c,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=l)return Math.round(e/l)+"d";if(t>=d)return Math.round(e/d)+"h";if(t>=h)return Math.round(e/h)+"m";if(t>=c)return Math.round(e/c)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function v(e,t,n,r){var o=t>=1.5*n;return Math.round(e/n)+" "+r+(o?"s":"")}var b=function(e){function t(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){let i;function s(...e){if(!s.enabled)return;const t=s,r=Number(new Date),o=r-(i||r);t.diff=o,t.prev=i,t.curr=r,i=r,e[0]=n.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let u=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,o)=>{if("%%"===r)return r;u++;const i=n.formatters[o];if("function"==typeof i){const n=e[u];r=i.call(t,n),e.splice(u,1),u--}return r}),n.formatArgs.call(t,e);(t.log||n.log).apply(t,e)}return s.namespace=e,s.enabled=n.enabled(e),s.useColors=n.useColors(),s.color=t(e),s.destroy=r,s.extend=o,"function"==typeof n.init&&n.init(s),n.instances.push(s),s}function r(){const e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function o(e,t){const r=n(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){const e=[...n.names.map(i),...n.skips.map(i).map(e=>"-"+e)].join(",");return n.enable(""),e},n.enable=function(e){let t;n.save(e),n.names=[],n.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(t=0;t<o;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")));for(t=0;t<n.instances.length;t++){const e=n.instances[t];e.enabled=n.enabled(e.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=y,Object.keys(e).forEach(t=>{n[t]=e[t]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=t,n.enable(n.load()),n},g=a((function(e,t){t.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,o=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(o=r))}),t.splice(o,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=b(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),m=function(){function e(){}return Object.defineProperty(e,"enabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),Object.defineProperty(e,"filter",{get:function(){return this._filter},enumerable:!1,configurable:!0}),e.enable=function(e){g.enable(e),this._filter=e,this._enabled=!0,this._onEnable.forEach((function(t){return t(e)}))},e.disable=function(){g.disable(),this._enabled=!1,this._onDisable.forEach((function(e){return e()}))},e.log=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this._logger[e]||(this._logger[e]=g(e)),(t=this._logger)[e].apply(t,n)},e.on=function(e,t){switch(e){case"enable":this._onEnable.push(t);break;case"disable":this._onDisable.push(t)}},e._enabled=!1,e._logger={},e._onEnable=[],e._onDisable=[],e}(),_=0;function w(e){return o(this,void 0,void 0,(function(){var t,n,o,s,a;return i(this,(function(i){switch(i.label){case 0:return t=u.get().request,n=C(e),o=++_,m.log("LC:Request:send","%d: %O",o,e),a=A,[4,t(n,r(r({},e.options),{method:e.method||"GET",headers:e.header,data:e.body}))];case 1:return s=a.apply(void 0,[i.sent()]),m.log("LC:Request:recv","%d: %O",o,s),[2,s]}}))}))}function C(e){if(!e.baseURL)throw new Error("Cannot send request: the baseURL is empty");var t=e.baseURL;e.path&&("/"===e.path[0]?t+=e.path:t+="/"+e.path);var n=function(e){var t="";return e&&Object.entries(e).forEach((function(e,n){var r=e[0],o=e[1];void 0!==o&&(n&&(t+="&"),t+=r+"="+encodeURIComponent(o))})),t}(e.query);return n&&(t+="?"+n),t}function A(e){return{status:e.status,header:e.headers,body:e.data}}var k="CURRENT_USER",S="SERVER_URLS";function T(e){if(e.async)throw new TypeError("The adapters provides an async storage, please use async method instead")}var O=function(){function e(){}return e.keyWithNamespace=function(e){return"LC:"+e},e.set=function(e,t){var n=u.get().storage;T(n),e=this.keyWithNamespace(e),n.setItem(e,t),m.log("LC:LocalStorage:set",e,t)},e.get=function(e){var t,n=u.get().storage;T(n),e=this.keyWithNamespace(e);var r=null!==(t=n.getItem(e))&&void 0!==t?t:null;return m.log("LC:LocalStorage:get",e,r),r},e.delete=function(e){var t=u.get().storage;T(t),e=this.keyWithNamespace(e),t.removeItem(e),m.log("LC:LocalStorage:delete",e)},e.setAsync=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return n=u.get().storage,e=this.keyWithNamespace(e),[4,n.setItem(e,t)];case 1:return r.sent(),m.log("LC:LocalStorage:set",e,t),[2]}}))}))},e.getAsync=function(e){var t;return o(this,void 0,void 0,(function(){var n,r;return i(this,(function(o){switch(o.label){case 0:return n=u.get().storage,e=this.keyWithNamespace(e),[4,n.getItem(e)];case 1:return r=null!==(t=o.sent())&&void 0!==t?t:null,m.log("LC:LocalStorage:get",e,r),[2,r]}}))}))},e.deleteAsync=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return t=u.get().storage,e=this.keyWithNamespace(e),[4,t.removeItem(e)];case 1:return n.sent(),m.log("LC:LocalStorage:delete",e),[2]}}))}))},e}(),q=function(){function e(e){this._ns=e}return e.prototype.keyWithNamespace=function(e){return this._ns+":"+e},e.prototype.set=function(e,t){O.set(this.keyWithNamespace(e),t)},e.prototype.get=function(e){return O.get(this.keyWithNamespace(e))},e.prototype.delete=function(e){O.delete(this.keyWithNamespace(e))},e.prototype.setAsync=function(e,t){return O.setAsync(this.keyWithNamespace(e),t)},e.prototype.getAsync=function(e){return O.getAsync(this.keyWithNamespace(e))},e.prototype.deleteAsync=function(e){return O.deleteAsync(this.keyWithNamespace(e))},e}();function P(e,t){return Object.prototype.toString.call(e)==="[object "+t+"]"}function N(e){return P(e,"Object")}function I(e,t){var n={};return Object.entries(e).forEach((function(e){var r=e[0],o=e[1];return n[r]=t(o,r)})),n}function j(e){return!e||0===Object.keys(e).length}function U(e,t){if(!e)throw new Error(t||"Assertion failed")}function R(e){return"string"==typeof e?e:e.aclKey}function x(e){return"string"==typeof e?e.startsWith("role:")?e:"role:"+e:e.aclKey}var E=function(){function e(){this.data={}}return e.fromJSON=function(t){var n=new e;return Object.entries(t).forEach((function(e){var t=e[0],r=e[1];!0===r.read?n.allow(t,"read"):!1===r.read&&n.deny(t,"read"),!0===r.write?n.allow(t,"write"):!1===r.write&&n.deny(t,"write")})),n},e.prototype.toJSON=function(){return this.data},e.prototype.allow=function(e,t){var n=R(e);return this.data[n]||(this.data[n]={}),this.data[n][t]=!0,this},e.prototype.deny=function(e,t){var n=R(e);return this.data[n]&&(delete this.data[n][t],j(this.data[n])&&delete this.data[n]),this},e.prototype.can=function(e,t){var n=R(e);return Boolean(this.data[n]&&this.data[n][t])},e.prototype.setPublicReadAccess=function(e){return e?this.allow("*","read"):this.deny("*","read")},e.prototype.getPublicReadAccess=function(){return this.can("*","read")},e.prototype.setPublicWriteAccess=function(e){return e?this.allow("*","write"):this.deny("*","write")},e.prototype.getPublicWriteAccess=function(){return this.can("*","write")},e.prototype.setReadAccess=function(e,t){return t?this.allow(e,"read"):this.deny(e,"read")},e.prototype.getReadAccess=function(e){return this.can(e,"read")},e.prototype.setWriteAccess=function(e,t){return t?this.allow(e,"write"):this.deny(e,"write")},e.prototype.getWriteAccess=function(e){return this.can(e,"write")},e.prototype.setRoleReadAccess=function(e,t){var n=x(e);return t?this.allow(n,"read"):this.deny(n,"read")},e.prototype.getRoleReadAccess=function(e){return this.can(x(e),"read")},e.prototype.setRoleWriteAccess=function(e,t){var n=x(e);return t?this.allow(n,"write"):this.deny(n,"write")},e.prototype.getRoleWriteAccess=function(e){return"string"!=typeof e||e.startsWith("role:")||(e="role:"+e),this.can(e,"write")},e}();function F(e){var t=r({},e);return["objectId","createdAt","updatedAt"].forEach((function(e){return delete t[e]})),t}var L=function(){function e(e,t,n){this.app=e,this.className=t,this.objectId=n}return e.prototype.toPointer=function(){return{__type:"Pointer",className:this.className,objectId:this.objectId}},e.prototype.get=function(e){var t,n;return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({method:"GET",path:"1.1/classes/"+this.className+"/"+this.objectId,query:{keys:null===(t=null==e?void 0:e.keys)||void 0===t?void 0:t.join(","),include:null===(n=null==e?void 0:e.include)||void 0===n?void 0:n.join(","),returnACL:null==e?void 0:e.returnACL},options:e})];case 1:if(j((r=o.sent()).body))throw new Error("The objectId '"+this.objectId+"' is not exists");return[2,W.decodeObject(this.app,r.body,this.className)]}}))}))},e.prototype.update=function(e,t){var n;return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/classes/"+this.className+"/"+this.objectId,body:W.encode(F(e)),query:{fetchWhenSave:null==t?void 0:t.fetch,where:null===(n=null==t?void 0:t.query)||void 0===n?void 0:n.toString()},options:t})];case 1:return r=o.sent(),[2,W.decodeObject(this.app,r.body,this.className)]}}))}))},e.prototype.delete=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.app.request({method:"DELETE",path:"1.1/classes/"+this.className+"/"+this.objectId,options:e})];case 1:return t.sent(),[2]}}))}))},e}(),D=function(){function e(e,t,n){this._ref=new L(e,t,n)}return e.extractData=function(t){var n=this;return t?t instanceof e?this.extractData(t.data):Array.isArray(t)?t.map((function(e){return n.extractData(e)})):N(t)?I(t,(function(e){return n.extractData(e)})):t:t},Object.defineProperty(e.prototype,"app",{get:function(){return this._ref.app},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._ref.className},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"objectId",{get:function(){return this._ref.objectId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.objectId},enumerable:!1,configurable:!0}),e.prototype.toPointer=function(){return this._ref.toPointer()},e.prototype.get=function(e){return this._ref.get(e)},e.prototype.update=function(e,t){return this._ref.update(e,t)},e.prototype.delete=function(e){return this._ref.delete(e)},e.prototype.toJSON=function(){var t=e.extractData(this);return t.objectId=this.objectId,this.createdAt&&(t.createdAt=this.createdAt),this.updatedAt&&(t.updatedAt=this.updatedAt),t},e.prototype.toFullJSON=function(){return W.encodeObject(this,!0)},e}(),W=function(){function e(){}return e.setCreator=function(e,t){this._creators.set(e,t)},e.create=function(e,t,n){var r=this._creators.get(t);return r?r(e,n,t):new D(e,t,n)},e.encode=function(e,t){var n=this;return e?e instanceof L?e.toPointer():e instanceof D?this.encodeObject(e,t):e instanceof E?e.toJSON():P(e,"Date")?{__type:"Date",iso:e.toISOString()}:Array.isArray(e)?e.map((function(e){return n.encode(e,t)})):N(e)?I(e,(function(e){return n.encode(e)})):e:e},e.encodeObject=function(e,t){if(!t)return e.toPointer();var n=this.encode(e.data,t);return n.__type="Object",n.className=e.className,n.objectId=e.objectId,e.createdAt&&(n.createdAt=e.createdAt.toISOString()),e.updatedAt&&(n.updatedAt=e.updatedAt.toISOString()),n},e.decode=function(e,t){var n=this;if(!t)return t;switch(t.__type){case"Pointer":case"Object":return this.decodeObject(e,t);case"Date":return new Date(t.iso);case"File":return this.decodeObject(e,t,"_File")}return Array.isArray(t)?t.map((function(t){return n.decode(e,t)})):N(t)?I(t,(function(t){return n.decode(e,t)})):t},e.decodeObject=function(e,t,n){n&&(t.className=n),U(t.className,"Decode failed: the className is empty"),U(t.objectId,"Decode failed: the objectId is empty");var o=this.create(e,t.className,t.objectId);return o.data=r({},t),function e(t,n){if(t)if(Array.isArray(n))n.forEach((function(n){return e(t,n)}));else if(n.includes(".")){var r=n.split(".");e(t[r[0]],r.slice(1).join("."))}else delete t[n]}(o.data,["className","objectId","ACL","__type","createdAt","updatedAt"]),o.data=this.decode(e,o.data),t.createdAt&&(o.createdAt=new Date(t.createdAt)),t.updatedAt&&(o.updatedAt=new Date(t.updatedAt)),t.ACL&&(o.data.ACL=E.fromJSON(t.ACL)),o},e._creators=new Map,e}(),M=function(e){function t(t,n){var r=e.call(this,"code: "+t+", message: "+n)||this;return r.code=t,r.error=n,r}return n(t,e),t}(Error);function B(e){return"-MdYXbMMI"!==("string"==typeof e?e:e.appId).slice(-9)}var $=function(){function e(e){this._refreshing=!1,this._app=e}return e.prototype.getURLs=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this._urls?[3,2]:[4,this._app.storage.getAsync(S)];case 1:e=t.sent(),this._urls=e?JSON.parse(e):this.getDefaultServerURLs(),t.label=2;case 2:return Date.now()>=this._urls.expire_at&&this.refresh(),[2,this._urls]}}))}))},e.prototype.getServiceURL=function(e){return void 0===e&&(e="api"),o(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return[4,this.getURLs()];case 1:switch(t=r.sent(),n="https://",e){case"api":return[2,n+t.api_server];case"engine":return[2,n+t.engine_server];default:throw new Error("Unknown service: "+e)}}}))}))},e.prototype.refresh=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:if(this._refreshing)return[2];this._refreshing=!0,t.label=1;case 1:return t.trys.push([1,,4,5]),[4,this._app.request({method:"GET",baseURL:"https://app-router.com",path:"2/route",query:{appId:this._app.appId}})];case 2:return e=t.sent(),this._urls=e.body,this._urls.expire_at=Date.now()+1e3*this._urls.ttl,[4,this._app.storage.setAsync(S,JSON.stringify(this._urls))];case 3:return t.sent(),[3,5];case 4:return this._refreshing=!1,[7];case 5:return[2]}}))}))},e.prototype.getDefaultServerURLs=function(){var e=B(this._app)?"lncld.net":"lncldglobal.com",t=this._app.appId.slice(0,8).toLowerCase();return{stats_server:t+".stats."+e,rtm_router_server:t+".rtm."+e,push_server:t+".push."+e,play_server:t+".play."+e,engine_server:t+".engine."+e,api_server:t+".api."+e,ttl:0,expire_at:0}},e}();var J=function(){function e(e){var t,n;this.appId=e.appId,this.appKey=e.appKey,this.serverURL=e.serverURL,this.masterKey=e.masterKey,this.useMasterKey=null!==(t=e.useMasterKey)&&void 0!==t&&t,this.production=null===(n=e.production)||void 0===n||n,U(this.appId,"The appId is required"),U(this.appKey,"The appKey is required"),B(this)&&U(this.serverURL,"The serverURL is required by CN App"),this.storage=new q(this.appId),this.serverURL||(this._router=new $(this))}return e.initDefault=function(t){U(!this._default,"Default app already initialized"),this._default=new e(t)},Object.defineProperty(e,"default",{get:function(){return U(this._default,"Default app not initialized"),this._default},enumerable:!1,configurable:!0}),e.prototype.request=function(e){var t,n;return o(this,void 0,void 0,(function(){var r,o,s,u,a,c,h,d;return i(this,(function(i){switch(i.label){case 0:return e.baseURL?[2,w(e)]:(r=e,(o=this.serverURL)?[3,2]:[4,this._router.getServiceURL(e.service)]);case 1:o=i.sent(),i.label=2;case 2:return r.baseURL=o,e.header=Object.assign(e.header||{},{"Content-Type":"application/json","X-LC-UA":K("LeanCloud-JS-SDK"),"X-LC-Id":this.appId,"X-LC-Key":this.appKey}),s=this.useMasterKey,void 0!==(null===(t=e.options)||void 0===t?void 0:t.useMasterKey)&&(s=e.options.useMasterKey),s&&(e.header["X-LC-Key"]=this.masterKey+",master"),(null===(n=e.options)||void 0===n?void 0:n.sessionToken)?(u=e.options.sessionToken,[3,5]):[3,3];case 3:return[4,this.getSessionTokenAsync()];case 4:u=i.sent(),i.label=5;case 5:return u&&(e.header["X-LC-Session"]=u),this.production||(e.header["X-LC-Prod"]="0"),[4,w(e)];case 6:if((a=i.sent()).status>=400)throw c=a.body,h=c.code,d=c.error,new M(h,d);return[2,a]}}))}))},e.prototype.decode=function(e){return W.decode(this,e)},e.prototype.decodeObject=function(e,t){return W.decodeObject(this,e,t)},e.prototype.pause=function(){this.realtimeInstance&&this.realtimeInstance.pause()},e.prototype.resume=function(){this.realtimeInstance&&this.realtimeInstance.resume()},e.prototype.getSessionToken=function(){if(this.currentUser)return this.currentUser.sessionToken;var e=this.storage.get(k);return e?JSON.parse(e).sessionToken:null},e.prototype.getSessionTokenAsync=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this.currentUser?[2,this.currentUser.sessionToken]:[4,this.storage.getAsync(k)];case 1:return(e=t.sent())?[2,JSON.parse(e).sessionToken]:[2,null]}}))}))},e}();function K(e){var t=e+"/5.0.0-dev";if(u.isSet){var n=u.get().platformInfo;if(n){var r=n.name,o=n.version;if(r)return o?t+" ("+r+"/"+o+")":t+" ("+r+")"}}return t}var Q=function(){function e(){}return e.register=function(e,t){m.log("LC:Plugin:register",e),this.plugins[e]=t},e.requestAdapters=function(){var e=this;return u.isSet?Promise.resolve(u.get()):(this._adaptersPromise||(this._adaptersPromise=new Promise((function(t){e._adaptersRecevier=t})),u.on("set",this._adaptersRecevier)),this._adaptersPromise)},e.getLogger=function(){return m},e.plugins={},e}(),z=function(e,t){this.__type="GeoPoint","number"==typeof e?(this.latitude=e,this.longitude=t):(this.latitude=e.latitude,this.longitude=e.longitude)},G=function(){function e(e,t){this.app=e,this.className=t,this._where={},this._keys=[],this._order=[],this._include=[]}return e.and=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];U(t.length>1,"The and method require at least 2 queries");for(var r=1;r<t.length;++r)U(t[r].className===t[0].className,"All queries must belongs to same Class"),U(t[r].app.appId===t[0].app.appId,"All queries must belongs to same App");var o=new e(t[0].app,t[0].className);return o._where={$and:t.map((function(e){return e.toJSON()}))},o},e.or=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];U(t.length>1,"The or method require at least 2 queries");var r=e.and.apply(e,t);return r._where.$or=r._where.$and,delete r._where.$and,r},Object.defineProperty(e.prototype,"or",{get:function(){if(j(this._where))return this;var t=new e(this.app,this.className);return t._danglingOr=this,t},enumerable:!1,configurable:!0}),e.prototype.select=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._clone();return n._keys=e,n},e.prototype.except=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._clone();return n._keys=e.map((function(e){return"-"+e})),n},e.prototype.orderBy=function(e,t){var n=this._clone();return"desc"===t?n._order.push("-"+e):n._order.push(e),n},e.prototype.skip=function(e){var t=this._clone();return t._skip=e,t},e.prototype.limit=function(e){var t=this._clone();return t._limit=e,t},e.prototype.include=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._clone();return n._include=e,n},e.prototype.returnACL=function(e){var t=this._clone();return t._returnACL=e,t},e.prototype.find=function(e){return o(this,void 0,void 0,(function(){var t,n,r=this;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request(this._makeRequest(e))];case 1:return t=o.sent(),[2,null==(n=t.body.results)?void 0:n.map((function(e){return W.decodeObject(r.app,e,r.className)}))]}}))}))},e.prototype.first=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,this.limit(1).find(e)];case 1:return[2,(t=n.sent()).length?t[0]:null]}}))}))},e.prototype.count=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return(t=this._makeRequest(e)).query.count=1,t.query.limit=0,[4,this.app.request(t)];case 1:return[2,n.sent().body.count]}}))}))},e.prototype.where=function(e,t,n){var r=this._clone();switch(t){case"==":r._whereEqualTo(e,n);break;case"!=":r._whereNotEqualTo(e,n);break;case">":r._whereGreaterThan(e,n);break;case">=":r._whereGreaterThanOrEqualTo(e,n);break;case"<":r._whereLessThan(e,n);break;case"<=":r._whereLessThanOrEqualTo(e,n);break;case"exists":r._whereExists(e);break;case"not-exists":r._whereNotExists(e);break;case"size-is":!function(e){U("number"==typeof e,"Need number, got "+e)}(n),r._whereSizeEqual(e,n);break;case"in":Y(n),0==n._keys.length?r._whereMachesQuery(e,n):(U(1===n._keys.length,"The sub-query expect select only one key"),r._whereMatchesKeyInQuery(e,n._keys[0],n));break;case"not-in":Y(n),0==n._keys.length?r._whereDoesNotMatchQuery(e,n):(U(1===n._keys.length,"The sub-query expect select only one key"),r._whereDoesNotMatcheKeyInQuery(e,n._keys[0],n));break;case"matches":r._whereMatches(e,n);break;case"starts-with":X(n),r._whereStartsWith(e,n);break;case"ends-with":X(n),r._whereEndsWith(e,n);break;case"contains":if("string"==typeof n)r._whereContains(e,n);else{if(!Array.isArray(n))throw new TypeError("Condition '"+t+"' accepts only string or array value");r._whereContainsAll(e,n)}break;case"contained-in":Z(n),r._whereContainedIn(e,n);break;case"not-contained-in":Z(n),r._whereNotContainedIn(e,n);break;case"near":!function(e){U(e instanceof z,"Need GeoPoint, got "+e)}(n),r._whereNear(e,n);break;case"within":!function(e){var t=e;if("object"==typeof t&&t.northeast instanceof z&&t.southwest instanceof z)return;throw new TypeError("Need GeoBox, got "+e)}(n),r._whereWithinGeoBox(e,n.southwest,n.northeast);break;case"within-radians":H(n),r._whereWithinRadians(e,n.point,n.max,n.min);break;case"within-miles":H(n),r._whereWithinMiles(e,n.point,n.max,n.min);break;case"within-kilometers":H(n),r._whereWithinKilometers(e,n.point,n.max,n.min);break;default:throw new TypeError("Unsupported condition '"+t+"'")}return r},e.prototype.toJSON=function(){if(this._danglingOr){if(j(this._where))return this._danglingOr.toJSON();var t=this._danglingOr;this._danglingOr=null;var n=e.or(t,this).toJSON();return this._danglingOr=t,n}var o=r({},this._where);return Object.entries(o).forEach((function(e){var t=e[0],n=e[1];void 0!==n.$eq&&(o[t]=n.$eq)})),o},e.prototype.toString=function(){return JSON.stringify(this)},e.prototype.subscribe=function(){var e=Q.plugins.LiveQuery;return U(e,"Query#subscribe need the LiveQuery plugin"),e.subscribe(this)},e.prototype._clone=function(t){return t||(t=new e(this.app,this.className)),Object.entries(this._where).forEach((function(e){var n=e[0],o=e[1];Array.isArray(o)?t._where[n]=s(o):t._where[n]=r({},o)})),t._keys=s(this._keys),t._order=s(this._order),t._include=s(this._include),t._skip=this._skip,t._limit=this._limit,t._returnACL=this._returnACL,t._danglingOr=this._danglingOr,t},e.prototype._makeRequest=function(e){var t={path:"1.1/classes/"+this.className,query:{limit:this._limit,skip:this._skip,returnACL:this._returnACL},options:e},n=this.toString();return"{}"!==n&&(t.query.where=n),this._include.length&&(t.query.include=this._include.join(",")),this._order.length&&(t.query.order=this._order.join(",")),this._keys.length&&(t.query.keys=this._keys.join(",")),t},e.prototype._addCondition=function(e,t,n){this._where[e]||(this._where[e]={}),this._where[e][t]=W.encode(n)},e.prototype._clearAllCondition=function(e){this._where[e]&&(this._where[e]={})},e.prototype._whereEqualTo=function(e,t){this._clearAllCondition(e),this._addCondition(e,"$eq",t)},e.prototype._whereNotEqualTo=function(e,t){this._addCondition(e,"$ne",t)},e.prototype._whereGreaterThan=function(e,t){this._addCondition(e,"$gt",t)},e.prototype._whereGreaterThanOrEqualTo=function(e,t){this._addCondition(e,"$gte",t)},e.prototype._whereLessThan=function(e,t){this._addCondition(e,"$lt",t)},e.prototype._whereLessThanOrEqualTo=function(e,t){this._addCondition(e,"$lte",t)},e.prototype._whereExists=function(e){this._addCondition(e,"$exists",!0)},e.prototype._whereNotExists=function(e){this._addCondition(e,"$exists",!1)},e.prototype._whereSizeEqual=function(e,t){this._addCondition(e,"$size",t)},e.prototype._whereMatchesKeyInQuery=function(e,t,n){this._addCondition(e,"$select",{key:t,query:{className:n.className,where:n.toJSON()}})},e.prototype._whereDoesNotMatcheKeyInQuery=function(e,t,n){this._addCondition(e,"$dontSelect",{key:t,query:{className:n.className,where:n.toJSON()}})},e.prototype._whereMachesQuery=function(e,t){this._addCondition(e,"$inQuery",{className:t.className,where:t.toJSON()})},e.prototype._whereDoesNotMatchQuery=function(e,t){this._addCondition(e,"$notInQuery",{className:t.className,where:t.toJSON()})},e.prototype._whereMatches=function(e,t){var n,r="";"string"==typeof t?n=t:(P(t,"RegExp")?n=t.source:(n=t.regexp,t.ignoreBlank&&(r+="x")),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s")),this._addCondition(e,"$regex",n),r&&this._addCondition(e,"$options",r)},e.prototype._whereStartsWith=function(e,t){this._whereMatches(e,"^"+V(t))},e.prototype._whereEndsWith=function(e,t){this._whereMatches(e,V(t)+"$")},e.prototype._whereContains=function(e,t){this._whereMatches(e,V(t))},e.prototype._whereContainsAll=function(e,t){this._addCondition(e,"$all",t)},e.prototype._whereContainedIn=function(e,t){this._addCondition(e,"$in",t)},e.prototype._whereNotContainedIn=function(e,t){this._addCondition(e,"$nin",t)},e.prototype._whereNear=function(e,t){this._addCondition(e,"$nearSphere",t)},e.prototype._whereWithinGeoBox=function(e,t,n){this._addCondition(e,"$within",{$box:[t,n]})},e.prototype._whereWithinRadians=function(e,t,n,r){this._whereNear(e,t),this._addCondition(e,"$maxDistanceInRadians",n),void 0!==r&&this._addCondition(e,"$minDistanceInRadians",r)},e.prototype._whereWithinMiles=function(e,t,n,r){this._whereNear(e,t),this._addCondition(e,"$maxDistanceInMiles",n),void 0!==r&&this._addCondition(e,"$minDistanceInMiles",r)},e.prototype._whereWithinKilometers=function(e,t,n,r){this._whereNear(e,t),this._addCondition(e,"$maxDistanceInKilometers",n),void 0!==r&&this._addCondition(e,"$minDistanceInKilometers",r)},e}();function V(e){return"\\Q"+e.replace("\\E","\\E\\\\E\\Q")+"\\E"}function X(e){U("string"==typeof e,"Need string, got "+e)}function Z(e){U(Array.isArray(e),"Need array, got "+e)}function Y(e){U(e instanceof G,"Need Query, got "+e)}function H(e){var t=e;if(!("object"==typeof t&&t.point instanceof z&&"number"==typeof t.max)||void 0!==t.min&&"number"!=typeof t.min)throw new TypeError("Need GeoDistance, got "+e)}var ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),Object.defineProperty(t.prototype,"_apiPath",{get:function(){return"1.1/classes/"+this.className},enumerable:!1,configurable:!0}),t.prototype.object=function(e){return new L(this.app,this.className,e)},t.prototype.add=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:this._apiPath,body:W.encode(F(e)),query:{fetchWhenSave:null==t?void 0:t.fetch},options:t})];case 1:return n=r.sent(),[2,W.decodeObject(this.app,n.body,this.className)]}}))}))},t}(G),te=function(){function e(){}return e.unset=function(){return{__op:"Delete"}},e.increment=function(e){return void 0===e&&(e=1),{__op:"Increment",amount:e}},e.decrement=function(e){return void 0===e&&(e=1),{__op:"Decrement",amount:e}},e.add=function(e){return Array.isArray(e)||(e=[e]),{__op:"Add",objects:e}},e.addUnique=function(e){return Array.isArray(e)||(e=[e]),{__op:"AddUnique",objects:e}},e.remove=function(e){return Array.isArray(e)||(e=[e]),{__op:"Remove",objects:e}},e.bitAnd=function(e){return{__op:"BitAnd",value:e}},e.bitOr=function(e){return{__op:"BitOr",value:e}},e.bitXor=function(e){return{__op:"BitXor",value:e}},e.addRelation=function(e){return Array.isArray(e)||(e=[e]),{__op:"AddRelation",objects:e.map((function(e){return e.toPointer()}))}},e.removeRelation=function(t){var n=e.addRelation(t);return n.__op="RemoveRelation",n},e}();W.setCreator("_User",(function(e,t){return new oe(e,t)}));var ne=function(){function e(){}return e.set=function(e,t){var n=W.encode(t,!0);e.storage.set(k,JSON.stringify(n)),e.currentUser=t},e.setAsync=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return n=W.encode(t,!0),[4,e.storage.setAsync(k,JSON.stringify(n))];case 1:return r.sent(),e.currentUser=t,[2]}}))}))},e.get=function(e){if(!e.currentUser){var t=e.storage.get(k);t&&(e.currentUser=W.decode(e,JSON.parse(t)))}return e.currentUser||null},e.getAsync=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return e.currentUser?[3,2]:[4,e.storage.getAsync(k)];case 1:(t=n.sent())&&(e.currentUser=W.decode(e,JSON.parse(t))),n.label=2;case 2:return[2,e.currentUser||null]}}))}))},e.remove=function(e){e.storage.delete(k),e.currentUser=null},e.removeAsync=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,e.storage.deleteAsync(k)];case 1:return t.sent(),e.currentUser=null,[2]}}))}))},e.syncData=function(e,t){var n=e.storage.get(k);if(n){var r=JSON.parse(n);t(r),delete r.password,e.storage.set(k,JSON.stringify(r)),e.currentUser=null}},e.syncDataAsync=function(e,t){return o(this,void 0,void 0,(function(){var n,r;return i(this,(function(o){switch(o.label){case 0:return[4,e.storage.getAsync(k)];case 1:return(n=o.sent())?(r=JSON.parse(n),t(r),delete r.password,[4,e.storage.setAsync(k,JSON.stringify(r))]):[2];case 2:return o.sent(),e.currentUser=null,[2]}}))}))},e}(),re=function(e){function t(t,n){return e.call(this,t,"_User",n)||this}return n(t,e),Object.defineProperty(t.prototype,"aclKey",{get:function(){return this.objectId},enumerable:!1,configurable:!0}),t.prototype.isCurrent=function(){var e=ne.get(this.app);return this.objectId===(null==e?void 0:e.objectId)},t.prototype.isCurrentAsync=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return[4,ne.getAsync(this.app)];case 1:return e=t.sent(),[2,this.objectId===(null==e?void 0:e.objectId)]}}))}))},t.prototype.get=function(t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,e.prototype.get.call(this,t)];case 1:return n=r.sent(),[4,this.isCurrentAsync()];case 2:return r.sent()?[4,ne.syncDataAsync(this.app,(function(e){Object.assign(e,W.encode(n,!0))}))]:[3,4];case 3:r.sent(),r.label=4;case 4:return[2,n]}}))}))},t.prototype.update=function(t,n){return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,e.prototype.update.call(this,t,n)];case 1:return r=o.sent(),[4,this.isCurrentAsync()];case 2:return o.sent()?[4,ne.syncDataAsync(this.app,(function(e){Object.assign(e,t,W.encode(r,!0))}))]:[3,4];case 3:o.sent(),o.label=4;case 4:return[2,r]}}))}))},t.prototype.delete=function(t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,e.prototype.delete.call(this,t)];case 1:return n.sent(),[4,this.isCurrentAsync()];case 2:return n.sent()?[4,ne.removeAsync(this.app)]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},t.prototype.getRoles=function(){return new G(this.app,"_Role").where("users","==",this).find()},t}(L),oe=function(e){function t(t,n){var r=e.call(this,t,"_User",n)||this;return r._ref=new re(t,n),r}return n(t,e),Object.defineProperty(t.prototype,"sessionToken",{get:function(){return this.data.sessionToken},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"aclKey",{get:function(){return this._ref.aclKey},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_anonymousId",{get:function(){var e;return null===(e=this.data.authData.anonymous)||void 0===e?void 0:e.id},enumerable:!1,configurable:!0}),t.prototype.isCurrent=function(){if(this.isAnonymous()){var e=ne.get(this.app);return this._anonymousId===e._anonymousId}return this._ref.isCurrent()},t.prototype.isCurrentAsync=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this.isAnonymous()?[4,ne.getAsync(this.app)]:[3,2];case 1:return e=t.sent(),[2,this._anonymousId===e._anonymousId];case 2:return[2,this._ref.isCurrentAsync()]}}))}))},t.prototype.isAnonymous=function(){var e;return!!(null===(e=this.data.authData)||void 0===e?void 0:e.anonymous)},t.prototype.isAuthenticated=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.app.request({path:"1.1/users/me",options:{sessionToken:this.sessionToken}})];case 1:return t.sent(),[2,!0];case 2:if(211!==(e=t.sent()).code)throw e;return[2,!1];case 3:return[2]}}))}))},t.prototype.updatePassword=function(e,t,n){return o(this,void 0,void 0,(function(){var o,s=this;return i(this,(function(i){switch(i.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/users/"+this.objectId+"/updatePassword",body:{old_password:e,new_password:t},options:r({sessionToken:this.sessionToken},n)})];case 1:return o=i.sent(),this.data.sessionToken=o.body.sessionToken,[4,this.isCurrentAsync()];case 2:return i.sent()?[4,ne.syncDataAsync(this.app,(function(e){e.sessionToken=s.sessionToken}))]:[3,4];case 3:i.sent(),i.label=4;case 4:return[2]}}))}))},t.prototype.associateWithAuthData=function(e,t,n){var o;return this.update({authData:(o={},o[e]=t,o)},r({fetch:!0},n))},t.prototype.associateWithAuthDataAndUnionId=function(e,t,n,r){var o,i;return Object.assign(t,{unionid:n,platform:null!==(o=null==r?void 0:r.unionIdPlatform)&&void 0!==o?o:"weixin",main_account:null!==(i=null==r?void 0:r.asMainAccount)&&void 0!==i&&i}),this.associateWithAuthData(e,t,r)},t.prototype.associateWithMiniApp=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,u.get().getAuthInfo(e)];case 1:return t=n.sent(),[2,this.associateWithAuthData(t.provider,t.authData,e)]}}))}))},t.prototype.dissociateAuthData=function(e){var t;return this.update(((t={})["authData."+e]=te.unset(),t),{fetch:!0})},t.prototype.signUp=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:if(!this.isAnonymous())throw new Error("User#signUp can only be invoked by an anonymous user");return U(e.username,"The username must be provided"),U(e.password,"The password must be provided"),[4,this.isCurrentAsync()];case 1:return n.sent()&&ne.syncDataAsync(this.app,(function(e){delete e.authData.anonymous})),[2,this.update(e,t)]}}))}))},t.prototype.refreshSessionToken=function(e){return o(this,void 0,void 0,(function(){var t,n=this;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/users/"+this.objectId+"/refreshSessionToken",options:r(r({},e),{sessionToken:this.sessionToken})})];case 1:return t=o.sent(),this.data.sessionToken=t.body.sessionToken,[4,this.isCurrentAsync()];case 2:return o.sent()?[4,ne.syncDataAsync(this.app,(function(e){e.sessionToken=n.sessionToken}))]:[3,4];case 3:o.sent(),o.label=4;case 4:return[2]}}))}))},t.prototype.follow=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(o){switch(o.label){case 0:return U(this.sessionToken,"Cannot create friendship for an unauthorized user"),n="string"==typeof e?e:e.objectId,[4,this.app.request({method:"POST",path:"1.1/users/"+this.objectId+"/friendship/"+n,body:null==t?void 0:t.data,options:r(r({},t),{sessionToken:this.sessionToken})})];case 1:return o.sent(),[2]}}))}))},t.prototype.unfollow=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(o){switch(o.label){case 0:return U(this.sessionToken,"Cannot remove friendship for an unauthorized user"),n="string"==typeof e?e:e.objectId,[4,this.app.request({method:"DELETE",path:"1.1/users/"+this.objectId+"/friendship/"+n,options:r(r({},t),{sessionToken:this.sessionToken})})];case 1:return o.sent(),[2]}}))}))},t.prototype.getRoles=function(){return this._ref.getRoles()},t.prototype.get=function(e){return this._ref.get(r({sessionToken:this.sessionToken},e))},t.prototype.update=function(e,t){return this._ref.update(e,r({sessionToken:this.sessionToken},t))},t.prototype.delete=function(e){return this._ref.delete(r({sessionToken:this.sessionToken},e))},t}(D),ie="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),se=new Uint8Array(16);function ue(){if(!ie)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ie(se)}var ae=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function ce(e){return"string"==typeof e&&ae.test(e)}for(var he=[],de=0;de<256;++de)he.push((de+256).toString(16).substr(1));function le(e,t,n){var r=(e=e||{}).random||(e.rng||ue)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(he[e[t+0]]+he[e[t+1]]+he[e[t+2]]+he[e[t+3]]+"-"+he[e[t+4]]+he[e[t+5]]+"-"+he[e[t+6]]+he[e[t+7]]+"-"+he[e[t+8]]+he[e[t+9]]+"-"+he[e[t+10]]+he[e[t+11]]+he[e[t+12]]+he[e[t+13]]+he[e[t+14]]+he[e[t+15]]).toLowerCase();if(!ce(n))throw TypeError("Stringified UUID is invalid");return n}(r)}var pe=function(e){function t(t){return e.call(this,t,"_User")||this}return n(t,e),Object.defineProperty(t.prototype,"_apiPath",{get:function(){return"1.1/users"},enumerable:!1,configurable:!0}),t.object=function(e){return new re(J.default,e)},t.current=function(){return ne.get(J.default)},t.currentAsync=function(){return ne.getAsync(J.default)},t.become=function(e,n){return new t(J.default).become(e,n)},t.signUp=function(e,n){return new t(J.default).signUp(e,n)},t.signUpOrLoginWithMobilePhone=function(e,n){return new t(J.default).signUpOrLoginWithMobilePhone(e,n)},t.loginWithData=function(e,n){return new t(J.default).loginWithData(e,n)},t.login=function(e,n,r){return new t(J.default).login(e,n,r)},t.loginWithAuthData=function(e,n,r){return new t(J.default).loginWithAuthData(e,n,r)},t.loginAnonymously=function(e){return new t(J.default).loginAnonymously(e)},t.loginWithEmail=function(e,n,r){return new t(J.default).loginWithEmail(e,n,r)},t.loginWithMobilePhone=function(e,n,r){return new t(J.default).loginWithMobilePhone(e,n,r)},t.loginWithMobilePhoneSMSCode=function(e,n,r){return new t(J.default).loginWithMobilePhoneSMSCode(e,n,r)},t.loginWithAuthDataAndUnionId=function(e,n,r,o){return new t(J.default).loginWithAuthDataAndUnionId(e,n,r,o)},t.loginWithMiniApp=function(e){return new t(J.default).loginWithMiniApp(e)},t.logOut=function(){new t(J.default).logOut()},t.logOutAsync=function(){return new t(J.default).logOutAsync()},t.requestEmailVerify=function(e,n){return new t(J.default).requestEmailVerify(e,n)},t.requestLoginSMSCode=function(e,n){return new t(J.default).requestLoginSMSCode(e,n)},t.requestMobilePhoneVerify=function(e,n){return new t(J.default).requestMobilePhoneVerify(e,n)},t.requestPasswordReset=function(e,n){return new t(J.default).requestPasswordReset(e,n)},t.requestPasswordResetBySMSCode=function(e,n){return new t(J.default).requestPasswordResetBySMSCode(e,n)},t.resetPasswordBySMSCode=function(e,n,r){return new t(J.default).resetPasswordBySMSCode(e,n,r)},t.verifyMobilePhone=function(e,n){return new t(J.default).verifyMobilePhone(e,n)},t.requestChangePhoneNumber=function(e,n){return new t(J.default).requestChangePhoneNumber(e,n)},t.changePhoneNumber=function(e,n,r){return new t(J.default).changePhoneNumber(e,n,r)},t.prototype.object=function(e){return new re(this.app,e)},t.prototype.current=function(){return ne.get(this.app)},t.prototype.currentAsync=function(){return ne.getAsync(this.app)},t.prototype.become=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({path:"1.1/users/me",options:r(r({},t),{sessionToken:e})})];case 1:return n=o.sent(),[2,this._decodeAndSetToCurrent(n.body)]}}))}))},t.prototype.signUp=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/users",body:F(e),options:t})];case 1:return n=r.sent(),[2,this._decodeAndSetToCurrent(n.body)]}}))}))},t.prototype.signUpOrLoginWithMobilePhone=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/usersByMobilePhone",body:F(e),options:t})];case 1:return n=r.sent(),[2,this._decodeAndSetToCurrent(n.body)]}}))}))},t.prototype.loginWithData=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/login",body:F(e),options:t})];case 1:return n=r.sent(),[2,this._decodeAndSetToCurrent(n.body)]}}))}))},t.prototype.login=function(e,t,n){return this.loginWithData({username:e,password:t},n)},t.prototype.loginWithAuthData=function(e,t,n){return o(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/users",body:{authData:(o={},o[e]=t,o)},query:{failOnNotExist:null==n?void 0:n.failOnNotExist},options:n})];case 1:return r=i.sent(),[2,this._decodeAndSetToCurrent(r.body)]}}))}))},t.prototype.loginAnonymously=function(e){return this.loginWithAuthData("anonymous",{id:le()},e)},t.prototype.loginWithEmail=function(e,t,n){return this.loginWithData({email:e,password:t},n)},t.prototype.loginWithMobilePhone=function(e,t,n){return this.loginWithData({mobilePhoneNumber:e,password:t},n)},t.prototype.loginWithMobilePhoneSMSCode=function(e,t,n){return this.loginWithData({mobilePhoneNumber:e,smsCode:t},n)},t.prototype.loginWithAuthDataAndUnionId=function(e,t,n,r){return t=Object.assign({},t,{platform:null==r?void 0:r.unionIdPlatform,main_account:null==r?void 0:r.asMainAccount,unionid:n}),this.loginWithAuthData(e,t,r)},t.prototype.loginWithMiniApp=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,u.get().getAuthInfo(e)];case 1:return t=n.sent(),[2,this.loginWithAuthData(t.provider,t.authData,e)]}}))}))},t.prototype.logOut=function(){ne.remove(this.app)},t.prototype.logOutAsync=function(){return ne.removeAsync(this.app)},t.prototype.requestEmailVerify=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestEmailVerify",body:{email:e},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.requestLoginSMSCode=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestLoginSmsCode",body:{mobilePhoneNumber:e,validate_token:null==t?void 0:t.validateToken},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.requestMobilePhoneVerify=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestMobilePhoneVerify",body:{mobilePhoneNumber:e,validate_token:null==t?void 0:t.validateToken},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.requestPasswordReset=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestPasswordReset",body:{email:e},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.requestPasswordResetBySMSCode=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestPasswordResetBySmsCode",body:{mobilePhoneNumber:e,validate_token:null==t?void 0:t.validateToken},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.resetPasswordBySMSCode=function(e,t,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/resetPasswordBySmsCode/"+e,body:{password:t},options:n})];case 1:return r.sent(),[2]}}))}))},t.prototype.verifyMobilePhone=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/verifyMobilePhone/"+e,options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.requestChangePhoneNumber=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestChangePhoneNumber",body:{mobilePhoneNumber:e,ttl:null==t?void 0:t.ttl},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.changePhoneNumber=function(e,t,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/changePhoneNumber",body:{mobilePhoneNumber:e,code:t},options:n})];case 1:return r.sent(),[2]}}))}))},t.prototype._decodeAndSetToCurrent=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return t=W.decodeObject(this.app,e,this.className),[4,ne.setAsync(this.app,t)];case 1:return n.sent(),[2,t]}}))}))},t}(ee);W.setCreator("_Role",(function(e,t){return new ye(e,t)}));var fe=function(e){function t(t,n){return e.call(this,t,"_Role",n)||this}return n(t,e),t.prototype.addUser=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/roles/"+this.objectId,body:{users:te.addRelation(e)},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.addRole=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/roles/"+this.objectId,body:{roles:te.addRelation(e)},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.removeUser=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/roles/"+this.objectId,body:{users:te.removeRelation(e)},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.removeRole=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/roles/"+this.objectId,body:{roles:te.removeRelation(e)},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.getUsersQuery=function(){return new G(this.app,"_User").where("$relatedTo","==",{key:"users",object:this})},t.prototype.getRolesQuery=function(){return new G(this.app,"_Role").where("$relatedTo","==",{key:"roles",object:this})},t.prototype.getUsers=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){return[2,this.getUsersQuery().find(e)]}))}))},t.prototype.getRoles=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){return[2,this.getRolesQuery().find(e)]}))}))},t.prototype.get=function(t){return e.prototype.get.call(this,t)},t.prototype.update=function(t,n){return e.prototype.update.call(this,t,n)},t}(L),ye=function(e){function t(t,n){var r=e.call(this,t,"_Role",n)||this;return r._ref=new fe(t,n),r}return n(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return this.data.name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"aclKey",{get:function(){return"role:"+this.data.name},enumerable:!1,configurable:!0}),t.prototype.addUser=function(e,t){return this._ref.addUser(e,t)},t.prototype.addRole=function(e,t){return this._ref.addRole(e,t)},t.prototype.removeUser=function(e,t){return this._ref.removeUser(e,t)},t.prototype.removeRole=function(e,t){return this._ref.removeRole(e,t)},t.prototype.getUsersQuery=function(){return this._ref.getUsersQuery()},t.prototype.getRolesQuery=function(){return this._ref.getRolesQuery()},t.prototype.getUsers=function(e){return this._ref.getUsers(e)},t.prototype.getRoles=function(e){return this._ref.getRoles(e)},t.prototype.get=function(t){return e.prototype.get.call(this,t)},t.prototype.update=function(t,n){return e.prototype.update.call(this,t,n)},t}(D),ve=function(e){function t(t){return e.call(this,t,"_Role")||this}return n(t,e),t.object=function(e){return new fe(J.default,e)},t.add=function(e,n){return new t(J.default).add(e,n)},t.prototype.object=function(e){return new fe(this.app,e)},t.prototype.add=function(e,t){return o(this,void 0,void 0,(function(){var n,o;return i(this,(function(i){switch(i.label){case 0:return n=r({},e),e.roles&&(n.roles=te.addRelation(e.roles)),e.users&&(n.users=te.addRelation(e.users)),[4,this.app.request({method:"POST",path:"1.1/roles",body:n,options:t})];case 1:return o=i.sent(),[2,W.decodeObject(this.app,o.body,this.className)]}}))}))},t}(ee),be=a((function(e,t){!function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<e.length;r++)n[e.charCodeAt(r)]=r;t.encode=function(t){var n,r=new Uint8Array(t),o=r.length,i="";for(n=0;n<o;n+=3)i+=e[r[n]>>2],i+=e[(3&r[n])<<4|r[n+1]>>4],i+=e[(15&r[n+1])<<2|r[n+2]>>6],i+=e[63&r[n+2]];return o%3==2?i=i.substring(0,i.length-1)+"=":o%3==1&&(i=i.substring(0,i.length-2)+"=="),i},t.decode=function(e){var t,r,o,i,s,u=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(u--,"="===e[e.length-2]&&u--);var h=new ArrayBuffer(u),d=new Uint8Array(h);for(t=0;t<a;t+=4)r=n[e.charCodeAt(t)],o=n[e.charCodeAt(t+1)],i=n[e.charCodeAt(t+2)],s=n[e.charCodeAt(t+3)],d[c++]=r<<2|o>>4,d[c++]=(15&o)<<4|i>>2,d[c++]=(3&i)<<6|63&s;return h}}()})),ge=function(){function e(){}return e.upload=function(e,t,n,s){return function(e,t){return o(this,void 0,void 0,(function(){var n,o,s,a;return i(this,(function(i){switch(i.label){case 0:return n=u.get().upload,o=C(e),m.log("LC:Upload:send","%O",e),a=A,[4,n(o,t,r(r({},e.options),{method:e.method||"POST",headers:e.header,data:e.form}))];case 1:return s=a.apply(void 0,[i.sent()]),m.log("LC:Upload:recv","%O",s),[2,s]}}))}))}({method:"POST",header:null==s?void 0:s.header,baseURL:n.upload_url,form:{name:e,key:n.key,token:n.token},options:s},{field:"file",name:e,data:t})},e}(),me=function(){function e(){}return e.upload=function(e,t,n,o){return w({method:"PUT",baseURL:n.upload_url,header:r({"Content-Type":n.mime_type,"Cache-Control":"public, max-age=31536000"},null==o?void 0:o.header),body:t,options:o})},e}();W.setCreator("_File",(function(e,t){return new we(e,t)}));var _e=function(e){function t(t,n){return e.call(this,t,"_File",n)||this}return n(t,e),t.prototype.get=function(t){return e.prototype.get.call(this,t)},t.prototype.update=function(t,n){return e.prototype.update.call(this,{name:t.name,url:t.url,mime_type:t.mime_type,metaData:t.metaData,ACL:t.ACL},n)},t}(L),we=function(e){function t(t,n){var r=e.call(this,t,"_File",n)||this;return r._ref=new _e(t,n),r}return n(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return this.data.name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this.data.url},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){var e;return null===(e=this.data.metaData)||void 0===e?void 0:e.size},enumerable:!1,configurable:!0}),t.prototype.thumbnailURL=function(e,t,n,r,o){void 0===n&&(n=100),void 0===r&&(r=!0),void 0===o&&(o="png");var i=r?2:1;return this.url+"?imageView/"+i+"/w/"+e+"/h/"+t+"/q/"+n+"/format/"+o},t.prototype.get=function(e){return this._ref.get(e)},t.prototype.update=function(e,t){return this._ref.update(e,t)},t}(D);var Ce=function(e){function t(t){return e.call(this,t,"_File")||this}return n(t,e),t.object=function(e){return new _e(J.default,e)},t.upload=function(e,n,r){return new t(J.default).upload(e,n,r)},t.uploadWithURL=function(e,n,r){return new t(J.default).uploadWithURL(e,n,r)},t.prototype.object=function(e){return new _e(this.app,e)},t.prototype.upload=function(e,t,n){return o(this,void 0,void 0,(function(){var o,s,u,a,c,h;return i(this,(function(i){switch(i.label){case 0:return t=this._parseFileData(t),o=r({},null==n?void 0:n.metaData),(null==n?void 0:n.sessionToken)?(o.owner=n.sessionToken,[3,3]):[3,1];case 1:return s=o,[4,this.app.getSessionTokenAsync()];case 2:s.owner=i.sent(),i.label=3;case 3:return o.owner||(o.owner="unknown"),o.size||(o.size=this._getFileSize(t)),[4,this._getFileTokens(e,null==n?void 0:n.mime,null==n?void 0:n.ACL,o)];case 4:u=i.sent(),a=this._getFileProvider(u.provider),i.label=5;case 5:return i.trys.push([5,8,,10]),[4,a.upload(e,t,u,n)];case 6:return i.sent(),[4,this._invokeFileCallback(u.token,!0)];case 7:return i.sent(),[3,10];case 8:return c=i.sent(),[4,this._invokeFileCallback(u.token,!1)];case 9:throw i.sent(),c;case 10:return(h=new we(this.app,u.objectId)).data=r(r({},u),{name:e,metaData:o}),h.createdAt=new Date(u.createdAt),h.updatedAt=h.createdAt,delete h.data.createdAt,[2,h]}}))}))},t.prototype.uploadWithURL=function(e,t,n){return o(this,void 0,void 0,(function(){var o,s,u,a;return i(this,(function(i){switch(i.label){case 0:return o=r(r({},null==n?void 0:n.metaData),{__source:"external"}),(null==n?void 0:n.sessionToken)?(o.owner=n.sessionToken,[3,3]):[3,1];case 1:return s=o,[4,this.app.getSessionTokenAsync()];case 2:s.owner=i.sent(),i.label=3;case 3:return o.owner||(o.owner="unknown"),[4,this.app.request({method:"POST",path:"1.1/files/"+e,body:{name:e,url:t,ACL:null==n?void 0:n.ACL,mime_type:null==n?void 0:n.mime,metaData:o}})];case 4:return u=i.sent(),(a=new we(this.app,u.body.objectId)).data=r(r({},u.body),{metaData:o}),a.createdAt=new Date(a.data.createdAt),a.updatedAt=a.createdAt,delete a.data.createdAt,[2,a]}}))}))},t.prototype._parseFileData=function(e){if(Array.isArray(e)){var t=new Uint8Array(e.length);if(e.forEach((function(e,n){return t[n]=e})),"undefined"!=typeof Blob)return new Blob([t]);if("undefined"!=typeof Buffer)return Buffer.from(t);throw new Error("Current platform cannot upload byte array encoded file")}if(e.base64){var n=function(e){if(e.startsWith("data:")){var t=e.split(","),n=t[0],r=t[1];if(null==n?void 0:n.endsWith("base64"))return r}return e}(e.base64);if("undefined"!=typeof Blob)return new Blob([be.decode(n)]);if("undefined"!=typeof Buffer)return Buffer.from(n,"base64");throw new Error("Current platform cannot upload base64 encoded file")}return e.blob?e.blob:e},t.prototype._getFileSize=function(e){return"undefined"!=typeof Blob&&e instanceof Blob?e.size:"undefined"!=typeof Buffer&&Buffer.isBuffer(e)?e.length:void 0},t.prototype._getFileTokens=function(e,t,n,r){return o(this,void 0,void 0,(function(){return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/fileTokens",body:{name:e,ACL:n,metaData:r,mime_type:t}})];case 1:return[2,o.sent().body]}}))}))},t.prototype._getFileProvider=function(e){switch(e){case"qiniu":return ge;case"s3":return me;default:throw new Error("Unsupported file provider: "+e)}},t.prototype._invokeFileCallback=function(e,t){return this.app.request({method:"POST",path:"1.1/fileCallback",body:{token:e,result:t}})},t}(ee),Ae=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.sendToFollowers=function(e,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){return[2,new t(J.default).sendToFollowers(e,n)]}))}))},t.sendToUser=function(e,n,r){return o(this,void 0,void 0,(function(){return i(this,(function(o){return[2,new t(J.default).sendToUser(e,n,r)]}))}))},t.deleteInboxStatus=function(e,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){return[2,new t(J.default).deleteInboxStatus(e,n)]}))}))},t.getUnreadCount=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(n){return[2,new t(J.default).getUnreadCount(e)]}))}))},t.resetUnreadCount=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(n){return[2,new t(J.default).resetUnreadCount(e)]}))}))},t.prototype.sendToFollowers=function(e,t){return o(this,void 0,void 0,(function(){var n,o;return i(this,(function(i){switch(i.label){case 0:return[4,ne.getAsync(this.app)];case 1:return U(n=i.sent(),"No user is logged in"),[4,this.app.request({method:"POST",path:"1.1/statuses",query:{fetchWhenSave:!0},body:{query:{className:"_Follower",keys:"follower",where:{user:n.toPointer()}},data:r(r({},e),{source:n.toPointer()}),inboxType:null==t?void 0:t.inboxType},options:t})];case 2:return o=i.sent(),[2,W.decodeObject(this.app,o.body,"_Status")]}}))}))},t.prototype.sendToUser=function(e,t,n){return o(this,void 0,void 0,(function(){var o,s,u;return i(this,(function(i){switch(i.label){case 0:return[4,ne.getAsync(this.app)];case 1:return U(o=i.sent(),"No user is logged in"),s="string"==typeof e?e:e.objectId,[4,this.app.request({method:"POST",path:"1.1/statuses",body:{query:{className:"_User",where:{objectId:s}},data:r(r({},t),{source:o.toPointer()}),inboxType:(null==n?void 0:n.inboxType)||"private"},options:n})];case 2:return u=i.sent(),[2,W.decodeObject(this.app,u.body,"_Status")]}}))}))},t.prototype.deleteInboxStatus=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,ne.getAsync(this.app)];case 1:return U(n=r.sent(),"No user is logged in"),[4,this.app.request({method:"DELETE",path:"1.1/subscribe/statuses/inbox",query:{owner:JSON.stringify(n.toPointer()),inboxType:null==t?void 0:t.inboxType,messageId:e},options:t})];case 2:return r.sent(),[2]}}))}))},t.prototype.getUnreadCount=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,ne.getAsync(this.app)];case 1:return U(t=n.sent(),"No user is logged in"),[4,this.app.request({method:"GET",path:"1.1/subscribe/statuses/count",query:{owner:JSON.stringify(t.toPointer()),inboxType:null==e?void 0:e.inboxType},options:e})];case 2:return[2,n.sent().body]}}))}))},t.prototype.resetUnreadCount=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,ne.getAsync(this.app)];case 1:return U(t=n.sent(),"No user is logged in"),[4,this.app.request({method:"POST",path:"1.1/subscribe/statuses/resetUnreadCount",query:{owner:JSON.stringify(t.toPointer()),inboxType:null==e?void 0:e.inboxType},options:e})];case 2:return n.sent(),[2]}}))}))},t}(function(e){function t(t){return void 0===t&&(t=J.default),e.call(this,t,"_Status")||this}return n(t,e),t.prototype.whereStatusOwner=function(e){var t=this._clone();return t._statusOwner="string"==typeof e?{__type:"Pointer",className:"_User",objectId:e}:e.toPointer(),t._whereEqualTo("source",t._statusOwner),t},t.prototype.whereInboxOwner=function(e){U(e.sessionToken,"Cannot query inbox for an unauthorized user");var t=this._clone();return t._inboxOwner=e,t},t.prototype.whereInboxType=function(e){var t=this._clone();return t._inboxType=e,t},t.prototype.whereSinceId=function(e){var t=this._clone();return t._sinceId=e,t},t.prototype.whereMaxId=function(e){var t=this._clone();return t._maxId=e,t},t.prototype._clone=function(n){return n||(n=new t(this.app)),(n=e.prototype._clone.call(this,n))._statusOwner=this._statusOwner,n._inboxOwner=this._inboxOwner,n._inboxType=this._inboxType,n._sinceId=this._sinceId,n._maxId=this._maxId,n},t.prototype._makeRequest=function(t){var n=e.prototype._makeRequest.call(this,t);return this._inboxOwner&&(U(void 0===this._statusOwner,"Cannot query both inboxOwner and statusOwner"),n.path="1.1/subscribe/statuses",n.options?n.options.sessionToken||(n.options.sessionToken=this._inboxOwner.sessionToken):n.options={sessionToken:this._inboxOwner.sessionToken},n.query.owner=JSON.stringify(this._inboxOwner.toPointer()),n.query.inboxType=this._inboxType,n.query.sinceId=this._sinceId,n.query.maxId=this._maxId),n},t}(G)),ke=function(){function e(e,t){var n,r,o=this;this._app=e,this.sid=t.sid,this.hits=null!==(n=t.hits)&&void 0!==n?n:0,this.data=null===(r=t.results)||void 0===r?void 0:r.map((function(e){return W.decodeObject(o._app,e)}))}return e.prototype.next=function(t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return 0===this.data.length?[2,this]:[4,this._app.request({method:"GET",path:"1.1/search/select",query:{sid:this.sid},options:t})];case 1:return n=r.sent(),[2,new e(this._app,n.body)]}}))}))},e}(),Se=function(){function e(){this._sortFields=[]}return e.prototype.orderBy=function(e,t,n){var r,o={order:t};return(null==n?void 0:n.mode)&&(o.mode=n.mode),(null==n?void 0:n.missing)&&(o.missing="_"+n.missing),this._sortFields.push(((r={})[e]=o,r)),this},e.prototype.whereNear=function(e,t,n){var o,i=r(r({},n),((o={})[e]={lat:t.latitude,lon:t.longitude},o));return this._sortFields.push({_geo_distance:i}),this},e.prototype.toString=function(){return JSON.stringify(this._sortFields)},e}(),Te=function(){function e(e,t){this._order=[],e instanceof J&&(this.app=e),"string"==typeof e&&(this.className=e),void 0===this.app&&(this.app=J.default),void 0===this.className&&(this.className=t)}return e.prototype.queryString=function(e){var t=this._clone();return t._q=e,t},e.prototype.skip=function(e){var t=this._clone();return t._skip=e,t},e.prototype.limit=function(e){var t=this._clone();return t._limit=e,t},e.prototype.sid=function(e){var t=this._clone();return t._sid=e,t},e.prototype.fields=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._clone();return n._fields=e,n},e.prototype.highlights=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._clone();return n._highlights=e,n},e.prototype.include=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._clone();return n._include=e,n},e.prototype.find=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request(this._makeRequest(e))];case 1:return t=n.sent(),[2,new ke(this.app,t.body)]}}))}))},e.prototype.orderBy=function(e,t){var n=this._clone();return"desc"===t?n._order.push("-"+e):n._order.push(e),n},e.prototype.sortBy=function(e){var t=this._clone();return t._sort=e.toString(),t},e.prototype._makeRequest=function(e){var t,n={method:"GET",path:"1.1/search/select",query:{q:this._q,skip:this._skip,limit:this._limit,sid:this._sid,clazz:this.className,sort:this._sort},options:e};return this._fields&&(n.query.fields=this._fields.join(",")),this._highlights&&(n.query.highlights=this._highlights.join(",")),this._include&&(n.query.include=this._include.join(",")),this._order.length&&(n.query.order=null===(t=this._order)||void 0===t?void 0:t.join(",")),n},e.prototype._clone=function(){var t=new e(this.app,this.className);return t._q=this._q,t._skip=this._skip,t._limit=this._limit,t._sid=this._sid,t._fields=this._fields,t._highlights=this._highlights,t._sort=this._sort,t._include=this._include,t._order=s(this._order),t},e}(),Oe=function(){function e(e){this.app=e}return e.request=function(t,n){return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return t instanceof J?[4,(r=new e(t)).refresh(n)]:[3,2];case 1:return o.sent(),[2,r];case 2:return[4,(r=new e(J.default)).refresh(t)];case 3:return o.sent(),[2,r]}}))}))},e.prototype.refresh=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return this.validateToken=null,[4,this.app.request({method:"GET",path:"1.1/requestCaptcha",query:{width:null==e?void 0:e.width,height:null==e?void 0:e.height,size:null==e?void 0:e.size,ttl:null==e?void 0:e.ttl},options:e})];case 1:return t=n.sent(),this.token=t.body.captcha_token,this.url=t.body.captcha_url,[2]}}))}))},e.prototype.verify=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:if(!this.token)throw new Error("The captcha token is empty, you should call refresh first");return[4,this.app.request({method:"POST",path:"1.1/verifyCaptcha",body:{captcha_code:e,captcha_token:this.token},options:t})];case 1:return n=r.sent(),this.validateToken=n.body.validate_token,[2,this.validateToken]}}))}))},e.prototype.bind=function(e){this._binder||(this._binder=new qe(this,e)),this._binder.bind()},e.prototype.unbind=function(){this._binder&&this._binder.unbind()},e}(),qe=function(){function e(e,t){this.captcha=e,"string"==typeof t.image?this.image=document.getElementById(t.image):this.image=t.image,"string"==typeof t.textInput?this.input=document.getElementById(t.textInput):this.input=t.textInput,"string"==typeof t.verifyButton?this.button=document.getElementById(t.verifyButton):this.button=t.verifyButton,this.onSuccess=t.success,this.onError=t.error,this.onRefresh=this.refresh.bind(this),this.onVerify=this.verify.bind(this)}return e.prototype.refresh=function(){var e;return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.captcha.refresh()];case 1:return n.sent(),this.image.src=this.captcha.url,this.input&&(this.input.value="",this.input.focus()),[3,3];case 2:return t=n.sent(),null===(e=this.onError)||void 0===e||e.call(this,t),[3,3];case 3:return[2]}}))}))},e.prototype.verify=function(){var e;return o(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=this.input.value,[4,this.captcha.verify(t)];case 1:return r.sent(),this.onSuccess&&this.onSuccess(this.captcha.validateToken),[3,3];case 2:return n=r.sent(),null===(e=this.onError)||void 0===e||e.call(this,n),[3,3];case 3:return[2]}}))}))},e.prototype.bind=function(){this.image&&(this.image.src=this.captcha.url,this.image.addEventListener("click",this.onRefresh)),this.input&&this.button&&this.button.addEventListener("click",this.onVerify)},e.prototype.unbind=function(){this.image&&this.image.removeEventListener("click",this.onRefresh),this.button&&this.button.removeEventListener("click",this.onVerify)},e}(),Pe=function(){function e(e){this.app=e}return e.requestSMSCode=function(t,n){return new e(J.default).requestSMSCode(t,n)},e.verifySMSCode=function(t,n,r){return new e(J.default).verifySMSCode(t,n,r)},e.run=function(t,n,r){return new e(J.default).run(t,n,r)},e.rpc=function(t,n,r){return new e(J.default).rpc(t,n,r)},e.prototype.requestSMSCode=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestSmsCode",body:r(r({},null==t?void 0:t.variables),{mobilePhoneNumber:e,smsType:null==t?void 0:t.smsType,ttl:null==t?void 0:t.ttl,name:null==t?void 0:t.name,op:null==t?void 0:t.op,template:null==t?void 0:t.template,sign:null==t?void 0:t.sign,validate_token:null==t?void 0:t.validateToken}),options:t})];case 1:return n.sent(),[2]}}))}))},e.prototype.verifySMSCode=function(e,t,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/verifySmsCode/"+t,body:{mobilePhoneNumber:e},options:n})];case 1:return r.sent(),[2]}}))}))},e.prototype.run=function(e,t,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({service:"engine",method:"POST",path:"1.1/functions/"+e,body:W.encode(t,!0),options:n})];case 1:return[2,r.sent().body.result]}}))}))},e.prototype.rpc=function(e,t,n){return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({service:"engine",method:"POST",path:"1.1/call/"+e,body:W.encode(t,!0),options:n})];case 1:return r=o.sent(),[2,W.decode(this.app,r.body.result)]}}))}))},e}(),Ne=function(){function e(e){this.app=e}return e.send=function(t,n){return new e(J.default).send(t,n)},e.prototype.send=function(e,t){var n,r,s;return o(this,void 0,void 0,(function(){return i(this,(function(o){switch(o.label){case 0:if((null==t?void 0:t.expirationTime)&&(null==t?void 0:t.expirationInterval))throw new Error("Both expirationTime and expirationInterval cannot be set");return[4,this.app.request({service:"push",method:"POST",path:"1.1/push",body:{data:e,where:null===(n=null==t?void 0:t.query)||void 0===n?void 0:n.toJSON(),channels:null==t?void 0:t.channels,push_time:null===(r=null==t?void 0:t.pushTime)||void 0===r?void 0:r.toISOString(),expiration_time:null===(s=null==t?void 0:t.expirationTime)||void 0===s?void 0:s.toISOString(),expiration_interval:null==t?void 0:t.expirationInterval,notification_id:null==t?void 0:t.notificationId,req_id:null==t?void 0:t.reqId,prod:null==t?void 0:t.prod,topic:null==t?void 0:t.topic,apns_team_id:null==t?void 0:t.apnsTeamId,flow_control:null==t?void 0:t.flowControl,_notificationChannel:null==t?void 0:t.notificationChannel},options:t})];case 1:return o.sent(),[2]}}))}))},e}();e.ACL=E,e.App=J,e.CLASS=function(e){return new ee(J.default,e)},e.Captcha=Oe,e.Class=ee,e.Cloud=Pe,e.File=Ce,e.GeoPoint=z,e.Op=te,e.Push=Ne,e.Query=G,e.Role=ve,e.SearchQuery=Te,e.SearchSortBuilder=Se,e.Status=Ae,e.User=pe,e.debug=m,e.init=function(e){J.initDefault(e)},e.setAdapters=function(e){u.set(e)},e.use=function(e){e.install(Q)},Object.defineProperty(e,"__esModule",{value:!0})}));
