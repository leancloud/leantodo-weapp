!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).LC={})}(this,(function(e){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)};function n(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var r=function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function o(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))}function i(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}function s(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,u=i.length;s<u;s++,o++)r[o]=i[s];return r}var u=null;function a(){if(!u)throw new Error("Adapters not set");return u}function c(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var h=1e3,d=60*h,p=60*d,l=24*p,f=7*l,y=365.25*l,v=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"weeks":case"week":case"w":return n*f;case"days":case"day":case"d":return n*l;case"hours":case"hour":case"hrs":case"hr":case"h":return n*p;case"minutes":case"minute":case"mins":case"min":case"m":return n*d;case"seconds":case"second":case"secs":case"sec":case"s":return n*h;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===n&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=l)return b(e,t,l,"day");if(t>=p)return b(e,t,p,"hour");if(t>=d)return b(e,t,d,"minute");if(t>=h)return b(e,t,h,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=l)return Math.round(e/l)+"d";if(t>=p)return Math.round(e/p)+"h";if(t>=d)return Math.round(e/d)+"m";if(t>=h)return Math.round(e/h)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function b(e,t,n,r){var o=t>=1.5*n;return Math.round(e/n)+" "+r+(o?"s":"")}var m=function(e){function t(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){let i;function s(...e){if(!s.enabled)return;const t=s,r=Number(new Date),o=r-(i||r);t.diff=o,t.prev=i,t.curr=r,i=r,e[0]=n.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let u=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,o)=>{if("%%"===r)return r;u++;const i=n.formatters[o];if("function"==typeof i){const n=e[u];r=i.call(t,n),e.splice(u,1),u--}return r}),n.formatArgs.call(t,e);(t.log||n.log).apply(t,e)}return s.namespace=e,s.enabled=n.enabled(e),s.useColors=n.useColors(),s.color=t(e),s.destroy=r,s.extend=o,"function"==typeof n.init&&n.init(s),n.instances.push(s),s}function r(){const e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function o(e,t){const r=n(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){const e=[...n.names.map(i),...n.skips.map(i).map(e=>"-"+e)].join(",");return n.enable(""),e},n.enable=function(e){let t;n.save(e),n.names=[],n.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(t=0;t<o;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")));for(t=0;t<n.instances.length;t++){const e=n.instances[t];e.enabled=n.enabled(e.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=v,Object.keys(e).forEach(t=>{n[t]=e[t]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=t,n.enable(n.load()),n},_=c((function(e,t){t.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,o=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(o=r))}),t.splice(o,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=m(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),g=function(){function e(){}return Object.defineProperty(e,"enabled",{get:function(){return e._enabled},enumerable:!1,configurable:!0}),Object.defineProperty(e,"filter",{get:function(){return e._filter},enumerable:!1,configurable:!0}),e.enable=function(t){e._enabled=!0,e._filter=t,_.enable(t),e._onEnable.forEach((function(e){return e(t)}))},e.disable=function(){e._enabled=!1,_.disable(),e._onDisable.forEach((function(e){return e()}))},e.log=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];e._getLogger(t).apply(void 0,n)},e.on=function(t,n){switch(t){case"enable":e._onEnable.push(n);break;case"disable":e._onDisable.push(n)}},e._getLogger=function(t){return e._logger[t]||(e._logger[t]=_(t)),e._logger[t]},e._enabled=!1,e._logger={},e._onEnable=[],e._onDisable=[],e}(),w="CURRENT_USER";function C(e){return o(this,void 0,void 0,(function(){var t,n,o,s;return i(this,(function(i){switch(i.label){case 0:return t=a().request,n=k(e),g.log("LC:Request:send","%O",e),s=A,[4,t(n,r(r({},e.options),{method:e.method||"GET",headers:e.header,data:e.body}))];case 1:return o=s.apply(void 0,[i.sent()]),g.log("LC:Request:recv","%O",o),[2,o]}}))}))}function k(e){if(!e.baseURL)throw new Error("Cannot send request: the baseURL is empty");var t=e.baseURL;e.path&&("/"===e.path[0]?t+=e.path:t+="/"+e.path);var n=function(e){var t="";return e&&Object.entries(e).forEach((function(e){var n=e[0],r=e[1];null!=r&&(t&&(t+="&"),t+=n+"="+encodeURIComponent(r))})),t}(e.query);return n&&(t+="?"+n),t}function A(e){return{status:e.status,header:e.headers,body:e.data}}function T(){var e="LeanCloud-JS-SDK/5.0.0-dev",t=a().platformInfo;if(t){var n=t.name,r=t.version;if(n)return r?e+" ("+n+"/"+r+")":e+" ("+n+")"}return e}function O(e){if(e.async)throw new TypeError("The adapters provides an async storage, please use async method instead")}var S={set:function(e,t){var n=a().storage;O(n),e="LC:"+e,n.setItem(e,t),g.log("LC:KV:set","%s = %o",e,t)},get:function(e){var t=a().storage;O(t),e="LC:"+e;var n=t.getItem(e);return g.log("LC:KV:get","%s = %o",e,n),n},delete:function(e){var t=a().storage;O(t),e="LC:"+e,t.removeItem(e),g.log("LC:KV:rm",e)},setAsync:function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return n=a().storage,e="LC:"+e,[4,n.setItem(e,t)];case 1:return r.sent(),g.log("LC:KV:set","%s = %o",e,t),[2]}}))}))},getAsync:function(e){return o(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t=a().storage,e="LC:"+e,[4,t.getItem(e)];case 1:return n=r.sent(),g.log("LC:KV:get","%s = %o",e,n),[2,n]}}))}))},deleteAsync:function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return t=a().storage,e="LC:"+e,[4,t.removeItem(e)];case 1:return n.sent(),g.log("LC:KV:rm",e),[2]}}))}))}};function q(e,t){return Object.prototype.toString.call(e)==="[object "+t+"]"}function I(e){return q(e,"Object")}function j(e){return!e||0===Object.keys(e).length}function N(e,t){if(!e)throw new Error(t||"Assertion failed")}var P=function(){function e(){this.data={}}return e.getSubjectId=function(e){return"string"==typeof e?e:e.ACLKey},e.fromJSON=function(t){var n=new e;return Object.entries(t).forEach((function(e){var t=e[0],r=e[1];!0===r.read?n.allow(t,"read"):!1===r.read&&n.deny(t,"read"),!0===r.write?n.allow(t,"write"):!1===r.write&&n.deny(t,"write")})),n},e.allowAllTo=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=new e;return t.forEach((function(e){r.allow(e,"read"),r.allow(e,"write")})),r},e.prototype.allow=function(t,n){var r=e.getSubjectId(t);return this.data[r]||(this.data[r]={}),this.data[r][n]=!0,this},e.prototype.allowRole=function(e,t){return"string"==typeof e&&(e="role:"+e),this.allow(e,t)},e.prototype.deny=function(t,n){var r=e.getSubjectId(t);return this.data[r]&&(delete this.data[r][n],j(this.data[r])&&delete this.data[r]),this},e.prototype.denyRole=function(e,t){return"string"==typeof e&&(e="role:"+e),this.allow(e,t)},e.prototype.can=function(t,n){var r=e.getSubjectId(t);return!(!this.data[r]||!this.data[r][n])},e.prototype.toJSON=function(){return this.data},e}();function U(e){var t=r({},e);return["objectId","createdAt","updatedAt"].forEach((function(e){return delete t[e]})),t}var x=function(){function e(e,t,n){this.app=e,this.className=t,this.objectId=n}return e.prototype.toPointer=function(){return{__type:"Pointer",className:this.className,objectId:this.objectId}},e.prototype.get=function(e){var t,n;return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({method:"GET",path:"1.1/classes/"+this.className+"/"+this.objectId,query:{keys:null===(t=null==e?void 0:e.keys)||void 0===t?void 0:t.join(","),include:null===(n=null==e?void 0:e.include)||void 0===n?void 0:n.join(","),returnACL:null==e?void 0:e.returnACL},options:e})];case 1:if(j((r=o.sent()).body))throw new Error("The objectId '"+this.objectId+"' is not exists");return[2,F.decodeObject(this.app,r.body,this.className)]}}))}))},e.prototype.update=function(e,t){var n;return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/classes/"+this.className+"/"+this.objectId,body:F.encode(U(e)),query:{fetchWhenSave:null==t?void 0:t.fetch,where:null===(n=null==t?void 0:t.query)||void 0===n?void 0:n.toString()},options:t})];case 1:return r=o.sent(),[2,F.decodeObject(this.app,r.body,this.className)]}}))}))},e.prototype.delete=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.app.request({method:"DELETE",path:"1.1/classes/"+this.className+"/"+this.objectId,options:e})];case 1:return t.sent(),[2]}}))}))},e}(),E=function(){function e(e,t,n){this._ref=new x(e,t,n)}return e.extractData=function(t){if(!t)return t;if("string"==typeof t.className&&"string"==typeof t.objectId&&t.data)return e.extractData(t.data);if(Array.isArray(t))return t.map((function(t){return e.extractData(t)}));if(I(t)){var n={};return Object.entries(t).forEach((function(t){var r=t[0],o=t[1];return n[r]=e.extractData(o)})),n}return t},Object.defineProperty(e.prototype,"app",{get:function(){return this._ref.app},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._ref.className},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"objectId",{get:function(){return this._ref.objectId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.objectId},enumerable:!1,configurable:!0}),e.prototype.toPointer=function(){return this._ref.toPointer()},e.prototype.get=function(e){return this._ref.get(e)},e.prototype.update=function(e,t){return this._ref.update(e,t)},e.prototype.delete=function(e){return this._ref.delete(e)},e.prototype.toJSON=function(){var t=e.extractData(this);return t.objectId=this.objectId,this.createdAt&&(t.createdAt=this.createdAt),this.updatedAt&&(t.updatedAt=this.updatedAt),t},e}(),F=function(){function e(){}return e.setCreator=function(t,n){e._creators.set(t,n)},e.create=function(t,n,r){var o=e._creators.get(n);return o?o(t,r,n):new E(t,n,r)},e.encode=function(t,n){if(!t)return t;if(t instanceof x)return t.toPointer();if(t instanceof E)return e.encodeObject(t,n);if(t instanceof P)return t.toJSON();if(q(t,"Date"))return{__type:"Date",iso:t.toISOString()};if(Array.isArray(t))return t.map((function(t){return e.encode(t)}));if(I(t)){var r={};return Object.entries(t).forEach((function(t){var n=t[0],o=t[1];r[n]=e.encode(o)})),r}return t},e.encodeObject=function(t,n){if(!n)return t.toPointer();var r=e.encode(t.data,n);return r.__type="Object",r.className=t.className,r.objectId=t.objectId,t.createdAt&&(r.createdAt=t.createdAt.toISOString()),t.updatedAt&&(r.updatedAt=t.updatedAt.toISOString()),r},e.decode=function(t,n,r){if(!n)return n;switch(n.__type){case"Pointer":case"Object":return e.decodeObject(t,n,r);case"Date":return new Date(n.iso);case"File":return n.className="_File",e.decodeObject(t,n,r)}if(r)return e.decodeObject(t,n,r);if(Array.isArray(n))return n.map((function(n){return e.decode(t,n)}));if(I(n)){var o={};return Object.entries(n).forEach((function(n){var r=n[0],i=n[1];o[r]=e.decode(t,i)})),o}return n},e.decodeObject=function(t,n,o){o||(o=n.className),N(o,"Decode failed: the className is empty"),N(n.objectId,"Decode failed: the objectId is empty");var i=e.create(t,o,n.objectId),s=r({},n);return["className","objectId","ACL","__type"].forEach((function(e){return delete s[e]})),i.data=e.decode(t,s),["createdAt","updatedAt"].forEach((function(e){n[e]&&(i[e]=new Date(n[e]),delete i.data[e])})),n.ACL&&(i.data.ACL=P.fromJSON(n.ACL)),i},e._creators=new Map,e}(),L=function(e){function t(t,n){var r=e.call(this,"code: "+t+", message: "+n)||this;return r.code=t,r.error=n,r}return n(t,e),t}(Error),R=function(){function e(e){this.app=e}return e.prototype.genKey=function(e){return this.app.appId+":"+e},e.prototype.set=function(e,t){S.set(this.genKey(e),t)},e.prototype.get=function(e){return S.get(this.genKey(e))},e.prototype.delete=function(e){S.delete(this.genKey(e))},e.prototype.setAsync=function(e,t){return S.setAsync(this.genKey(e),t)},e.prototype.getAsync=function(e){return S.getAsync(this.genKey(e))},e.prototype.deleteAsync=function(e){return S.deleteAsync(this.genKey(e))},e}(),D=function(){function e(e){var t;this.useMasterKey=!1,this.appId=e.appId,this.appKey=e.appKey,this.serverURL=e.serverURL,this.masterKey=e.masterKey,this.production=null===(t=e.production)||void 0===t||t,this.kv=new R(this)}return e.prototype.request=function(e){var t,n;return o(this,void 0,void 0,(function(){var r,o,s,u,a,c;return i(this,(function(i){switch(i.label){case 0:return e.baseURL||(e.baseURL=e.baseURL=this.serverURL),e.baseURL!==this.serverURL?[3,4]:(e.header=Object.assign(e.header||{},{"Content-Type":"application/json","X-LC-UA":T(),"X-LC-Id":this.appId,"X-LC-Key":this.appKey}),r=this.useMasterKey,void 0!==(null===(t=e.options)||void 0===t?void 0:t.useMasterKey)&&(r=e.options.useMasterKey),r&&(e.header["X-LC-Key"]=this.masterKey+",master"),o=void 0,(null===(n=e.options)||void 0===n?void 0:n.sessionToken)?(o=e.options.sessionToken,[3,3]):[3,1]);case 1:return[4,this.getSessionTokenAsync()];case 2:o=i.sent(),i.label=3;case 3:o&&(e.header["X-LC-Session"]=o),this.production||(e.header["X-LC-Prod"]="0"),i.label=4;case 4:return[4,C(e)];case 5:if((s=i.sent()).status>=400&&e.baseURL===this.serverURL)throw u=s.body,a=u.code,c=u.error,new L(a,c);return[2,s]}}))}))},e.prototype.decode=function(e,t){return F.decode(this,e,t)},e.prototype.decodeObject=function(e){return F.decodeObject(this,e)},e.prototype.getAdapters=function(){return a()},e.prototype.getLogger=function(){return g},e.prototype.pause=function(){this.realtimeInstance&&this.realtimeInstance.pause()},e.prototype.resume=function(){this.realtimeInstance&&this.realtimeInstance.resume()},e.prototype.getSessionTokenAsync=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this.currentUser?[2,this.currentUser.sessionToken]:[4,this.kv.getAsync(w)];case 1:return(e=t.sent())?[2,JSON.parse(e).sessionToken]:[2,null]}}))}))},e}();var M=function(e,t){this.__type="GeoPoint","number"==typeof e?(this.latitude=e,this.longitude=t):(this.latitude=e.latitude,this.longitude=e.longitude)},$=function(){function e(e,t){this.app=e,this.className=t,this._where={},this._keys=[],this._order=[],this._include=[]}return e.and=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];N(t.length>1,"The and method require at least 2 queries");for(var r=1;r<t.length;++r)N(t[r].className===t[0].className,"All queries must belongs to same Class"),N(t[r].app.appId===t[0].app.appId,"All queries must belongs to same App");var o=new e(t[0].app,t[0].className);return o._where={$and:t.map((function(e){return e.toJSON()}))},o},e.or=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];N(t.length>1,"The or method require at least 2 queries");var r=e.and.apply(e,t);return r._where.$or=r._where.$and,delete r._where.$and,r},e.prototype.or=function(){if(j(this._where))return this;var t=new e(this.app,this.className);return t._danglingOr=this,t},e.prototype.select=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._clone();return n._keys=e,n},e.prototype.except=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._clone();return n._keys=e.map((function(e){return"-"+e})),n},e.prototype.orderBy=function(e,t){var n=this._clone();return"desc"===t?n._order.push("-"+e):n._order.push(e),n},e.prototype.skip=function(e){var t=this._clone();return t._skip=e,t},e.prototype.limit=function(e){var t=this._clone();return t._limit=e,t},e.prototype.include=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._clone();return n._include=e,n},e.prototype.returnACL=function(e){var t=this._clone();return t._returnACL=e,t},e.prototype.find=function(e){return o(this,void 0,void 0,(function(){var t,n,r=this;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request(this._makeRequest(e))];case 1:return t=o.sent(),[2,null==(n=t.body.results)?void 0:n.map((function(e){return r.app.decode(e,r.className)}))]}}))}))},e.prototype.first=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,this.limit(1).find(e)];case 1:return[2,(t=n.sent()).length?t[0]:null]}}))}))},e.prototype.count=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return(t=this._makeRequest(e)).query.count=1,t.query.limit=0,[4,this.app.request(t)];case 1:return[2,n.sent().body.count]}}))}))},e.prototype.where=function(e,t,n){var r=this._clone();switch(t){case"==":r._whereEqualTo(e,n);break;case"!=":r._whereNotEqualTo(e,n);break;case">":r._whereGreaterThan(e,n);break;case">=":r._whereGreaterThanOrEqualTo(e,n);break;case"<":r._whereLessThan(e,n);break;case"<=":r._whereLessThanOrEqualTo(e,n);break;case"exists":r._whereExists(e);break;case"not-exists":r._whereNotExists(e);break;case"size-is":!function(e){N("number"==typeof e,"Need number, got "+e)}(n),r._whereSizeEqual(e,n);break;case"in":J(n),0==n._keys.length?r._whereMachesQuery(e,n):(N(1===n._keys.length,"The sub-query expect select only one key"),r._whereMatchesKeyInQuery(e,n._keys[0],n));break;case"not-in":J(n),0==n._keys.length?r._whereDoesNotMatchQuery(e,n):(N(1===n._keys.length,"The sub-query expect select only one key"),r._whereDoesNotMatcheKeyInQuery(e,n._keys[0],n));break;case"matches":r._whereMatches(e,n);break;case"starts-with":K(n),r._whereStartsWith(e,n);break;case"ends-with":K(n),r._whereEndsWith(e,n);break;case"contains":if("string"==typeof n)r._whereContains(e,n);else{if(!Array.isArray(n))throw new TypeError("Condition '"+t+"' accepts only string or array value");r._whereContainsAll(e,n)}break;case"contains-any":W(n),r._whereContainedIn(e,n);break;case"not-contains-any":W(n),r._whereNotContainedIn(e,n);break;case"near":!function(e){N(e instanceof M,"Need GeoPoint, got "+e)}(n),r._whereNear(e,n);break;case"within":!function(e){var t=e;if("object"==typeof t&&t.northeast instanceof M&&t.southwest instanceof M)return;throw new TypeError("Need GeoBox, got "+e)}(n),r._whereWithinGeoBox(e,n.southwest,n.northeast);break;case"within-radians":Q(n),r._whereWithinRadians(e,n.point,n.max,n.min);break;case"within-miles":Q(n),r._whereWithinMiles(e,n.point,n.max,n.min);break;case"within-kilometers":Q(n),r._whereWithinKilometers(e,n.point,n.max,n.min);break;default:throw new TypeError("Unsupported condition '"+t+"'")}return r},e.prototype.toJSON=function(){if(this._danglingOr){if(j(this._where))return this._danglingOr.toJSON();var t=this._danglingOr;this._danglingOr=null;var n=e.or(t,this).toJSON();return this._danglingOr=t,n}var o=r({},this._where);return Object.entries(o).forEach((function(e){var t=e[0],n=e[1];void 0!==n.$eq&&(o[t]=n.$eq)})),o},e.prototype.toString=function(){return JSON.stringify(this)},e.prototype.subscribe=function(){return N(D.LiveQuery,"Query#subscribe need the LiveQuery module"),D.LiveQuery.subscribe(this)},e.prototype._clone=function(t){return t||(t=new e(this.app,this.className)),Object.entries(this._where).forEach((function(e){var n=e[0],o=e[1];Array.isArray(o)?t._where[n]=s(o):t._where[n]=r({},o)})),t._keys=s(this._keys),t._order=s(this._order),t._include=s(this._include),t._skip=this._skip,t._limit=this._limit,t._returnACL=this._returnACL,t._danglingOr=this._danglingOr,t},e.prototype._makeRequest=function(e){var t={path:"1.1/classes/"+this.className,query:{limit:this._limit,skip:this._skip,returnACL:this._returnACL},options:e},n=this.toString();return"{}"!==n&&(t.query.where=n),this._include.length&&(t.query.include=this._include.join(",")),this._order.length&&(t.query.order=this._order.join(",")),this._keys.length&&(t.query.keys=this._keys.join(",")),t},e.prototype._addCondition=function(e,t,n){this._where[e]||(this._where[e]={}),this._where[e][t]=F.encode(n)},e.prototype._clearAllCondition=function(e){this._where[e]&&(this._where[e]={})},e.prototype._whereEqualTo=function(e,t){this._clearAllCondition(e),this._addCondition(e,"$eq",t)},e.prototype._whereNotEqualTo=function(e,t){this._addCondition(e,"$ne",t)},e.prototype._whereGreaterThan=function(e,t){this._addCondition(e,"$gt",t)},e.prototype._whereGreaterThanOrEqualTo=function(e,t){this._addCondition(e,"$gte",t)},e.prototype._whereLessThan=function(e,t){this._addCondition(e,"$lt",t)},e.prototype._whereLessThanOrEqualTo=function(e,t){this._addCondition(e,"$lte",t)},e.prototype._whereExists=function(e){this._addCondition(e,"$exists",!0)},e.prototype._whereNotExists=function(e){this._addCondition(e,"$exists",!1)},e.prototype._whereSizeEqual=function(e,t){this._addCondition(e,"$size",t)},e.prototype._whereMatchesKeyInQuery=function(e,t,n){this._addCondition(e,"$select",{key:t,query:{className:n.className,where:n.toJSON()}})},e.prototype._whereDoesNotMatcheKeyInQuery=function(e,t,n){this._addCondition(e,"$dontSelect",{key:t,query:{className:n.className,where:n.toJSON()}})},e.prototype._whereMachesQuery=function(e,t){this._addCondition(e,"$inQuery",{className:t.className,where:t.toJSON()})},e.prototype._whereDoesNotMatchQuery=function(e,t){this._addCondition(e,"$notInQuery",{className:t.className,where:t.toJSON()})},e.prototype._whereMatches=function(e,t){var n,r="";"string"==typeof t?n=t:(q(t,"RegExp")?n=t.source:(n=t.regexp,t.ignoreBlank&&(r+="x")),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s")),this._addCondition(e,"$regex",n),r&&this._addCondition(e,"$options",r)},e.prototype._whereStartsWith=function(e,t){this._whereMatches(e,"^"+B(t))},e.prototype._whereEndsWith=function(e,t){this._whereMatches(e,B(t)+"$")},e.prototype._whereContains=function(e,t){this._whereMatches(e,B(t))},e.prototype._whereContainsAll=function(e,t){this._addCondition(e,"$all",t)},e.prototype._whereContainedIn=function(e,t){this._addCondition(e,"$in",t)},e.prototype._whereNotContainedIn=function(e,t){this._addCondition(e,"$nin",t)},e.prototype._whereNear=function(e,t){this._addCondition(e,"$nearSphere",t)},e.prototype._whereWithinGeoBox=function(e,t,n){this._addCondition(e,"$within",{$box:[t,n]})},e.prototype._whereWithinRadians=function(e,t,n,r){this._whereNear(e,t),this._addCondition(e,"$maxDistanceInRadians",n),void 0!==r&&this._addCondition(e,"$minDistanceInRadians",r)},e.prototype._whereWithinMiles=function(e,t,n,r){this._whereNear(e,t),this._addCondition(e,"$maxDistanceInMiles",n),void 0!==r&&this._addCondition(e,"$minDistanceInMiles",r)},e.prototype._whereWithinKilometers=function(e,t,n,r){this._whereNear(e,t),this._addCondition(e,"$maxDistanceInKilometers",n),void 0!==r&&this._addCondition(e,"$minDistanceInKilometers",r)},e}();function B(e){return"\\Q"+e.replace("\\E","\\E\\\\E\\Q")+"\\E"}function K(e){N("string"==typeof e,"Need string, got "+e)}function W(e){N(Array.isArray(e),"Need array, got "+e)}function J(e){N(e instanceof $,"Need Query, got "+e)}function Q(e){var t=e;if(!("object"==typeof t&&t.point instanceof M&&"number"==typeof t.max)||void 0!==t.min&&"number"!=typeof t.min)throw new TypeError("Need GeoDistance, got "+e)}var z=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.object=function(e){return new x(this.app,this.className,e)},t.prototype.add=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/classes/"+this.className,body:F.encode(U(e)),query:{fetchWhenSave:null==t?void 0:t.fetch},options:t})];case 1:return n=r.sent(),[2,this.app.decode(n.body,this.className)]}}))}))},t}($),G=function(){function e(){}return e.unset=function(){return{__op:"Delete"}},e.increment=function(e){return void 0===e&&(e=1),{__op:"Increment",amount:e}},e.decrement=function(e){return void 0===e&&(e=1),{__op:"Decrement",amount:e}},e.add=function(e){return Array.isArray(e)||(e=[e]),{__op:"Add",objects:e}},e.addUnique=function(e){return Array.isArray(e)||(e=[e]),{__op:"AddUnique",objects:e}},e.remove=function(e){return Array.isArray(e)||(e=[e]),{__op:"Remove",objects:e}},e.bitAnd=function(e){return{__op:"BitAnd",value:e}},e.bitOr=function(e){return{__op:"BitOr",value:e}},e.bitXor=function(e){return{__op:"BitXor",value:e}},e.addRelation=function(e){return Array.isArray(e)||(e=[e]),{__op:"AddRelation",objects:e.map((function(e){return e.toPointer()}))}},e.removeRelation=function(t){var n=e.addRelation(t);return n.__op="RemoveRelation",n},e}();F.setCreator("_User",(function(e,t){return new Z(e,t)}));var V=function(){function e(){}return e.setCurrentUser=function(e,t){var n=F.encode(t,!0);e.kv.set(w,JSON.stringify(n)),e.currentUser=t},e.setCurrentAsync=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return n=F.encode(t,!0),[4,e.kv.setAsync(w,JSON.stringify(n))];case 1:return r.sent(),e.currentUser=t,[2]}}))}))},e.getCurrentUser=function(e){if(!e.currentUser){var t=e.kv.get(w);t&&(e.currentUser=e.decode(JSON.parse(t)))}return e.currentUser},e.getCurrentUserAsync=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return e.currentUser?[3,2]:[4,e.kv.getAsync(w)];case 1:(t=n.sent())&&(e.currentUser=e.decode(JSON.parse(t))),n.label=2;case 2:return[2,e.currentUser]}}))}))},e.removeCurrentUser=function(e){e.kv.delete(w),e.currentUser=null},e.removeCurrentUserAsync=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,e.kv.deleteAsync(w)];case 1:return t.sent(),e.currentUser=null,[2]}}))}))},e.syncCurrentUser=function(e,t){var n=e.kv.get(w);if(n){var r=JSON.parse(n);t(r),delete r.password,e.kv.set(w,JSON.stringify(r)),e.currentUser=null}},e.syncCurrentUserAsync=function(e,t){return o(this,void 0,void 0,(function(){var n,r;return i(this,(function(o){switch(o.label){case 0:return[4,e.kv.getAsync(w)];case 1:return(n=o.sent())?(r=JSON.parse(n),t(r),delete r.password,[4,e.kv.setAsync(w,JSON.stringify(r))]):[2];case 2:return o.sent(),e.currentUser=null,[2]}}))}))},e}(),X=function(e){function t(t,n){return e.call(this,t,"_User",n)||this}return n(t,e),Object.defineProperty(t.prototype,"ACLKey",{get:function(){return this.objectId},enumerable:!1,configurable:!0}),t.prototype.isCurrent=function(){var e=V.getCurrentUser(this.app);return this.objectId===(null==e?void 0:e.objectId)},t.prototype.isCurrentAsync=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return[4,V.getCurrentUserAsync(this.app)];case 1:return e=t.sent(),[2,this.objectId===(null==e?void 0:e.objectId)]}}))}))},t.prototype.get=function(t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,e.prototype.get.call(this,t)];case 1:return n=r.sent(),[4,this.isCurrentAsync()];case 2:return r.sent()?[4,V.syncCurrentUserAsync(this.app,(function(e){Object.assign(e,F.encode(n,!0))}))]:[3,4];case 3:r.sent(),r.label=4;case 4:return[2,n]}}))}))},t.prototype.update=function(t,n){return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,e.prototype.update.call(this,t,n)];case 1:return r=o.sent(),[4,this.isCurrentAsync()];case 2:return o.sent()?[4,V.syncCurrentUserAsync(this.app,(function(e){Object.assign(e,t,F.encode(r,!0))}))]:[3,4];case 3:o.sent(),o.label=4;case 4:return[2,r]}}))}))},t.prototype.delete=function(t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,e.prototype.delete.call(this,t)];case 1:return n.sent(),[4,this.isCurrentAsync()];case 2:return n.sent()?[4,V.removeCurrentUserAsync(this.app)]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},t.prototype.getRoles=function(){return new $(this.app,"_Role").where("users","==",this).find()},t}(x),Z=function(e){function t(t,n){var r=e.call(this,t,"_User",n)||this;return r._ref=new X(t,n),r}return n(t,e),Object.defineProperty(t.prototype,"sessionToken",{get:function(){return this.data.sessionToken},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ACLKey",{get:function(){return this._ref.ACLKey},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_anonymousId",{get:function(){var e;return null===(e=this.data.authData.anonymous)||void 0===e?void 0:e.id},enumerable:!1,configurable:!0}),t.prototype.isCurrent=function(){if(this.isAnonymous()){var e=V.getCurrentUser(this.app);return this._anonymousId===e._anonymousId}return this._ref.isCurrent()},t.prototype.isCurrentAsync=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this.isAnonymous()?[4,V.getCurrentUserAsync(this.app)]:[3,2];case 1:return e=t.sent(),[2,this._anonymousId===e._anonymousId];case 2:return[2,this._ref.isCurrentAsync()]}}))}))},t.prototype.isAnonymous=function(){var e;return!!(null===(e=this.data.authData)||void 0===e?void 0:e.anonymous)},t.prototype.isAuthenticated=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.app.request({path:"1.1/users/me",options:{sessionToken:this.sessionToken}})];case 1:return t.sent(),[2,!0];case 2:if(211!==(e=t.sent()).code)throw e;return[2,!1];case 3:return[2]}}))}))},t.prototype.updatePassword=function(e,t,n){return o(this,void 0,void 0,(function(){var o,s=this;return i(this,(function(i){switch(i.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/users/"+this.objectId+"/updatePassword",body:{old_password:e,new_password:t},options:r({sessionToken:this.sessionToken},n)})];case 1:return o=i.sent(),this.data.sessionToken=o.body.sessionToken,[4,this.isCurrentAsync()];case 2:return i.sent()?[4,V.syncCurrentUserAsync(this.app,(function(e){e.sessionToken=s.sessionToken}))]:[3,4];case 3:i.sent(),i.label=4;case 4:return[2]}}))}))},t.prototype.associateWithAuthData=function(e,t,n){var o;return this.update({authData:(o={},o[e]=t,o)},r({fetch:!0},n))},t.prototype.associateWithAuthDataAndUnionId=function(e,t,n,r){var o,i;return Object.assign(t,{unionid:n,platform:null!==(o=null==r?void 0:r.unionIdPlatform)&&void 0!==o?o:"weixin",main_account:null!==(i=null==r?void 0:r.asMainAccount)&&void 0!==i&&i}),this.associateWithAuthData(e,t,r)},t.prototype.associateWithMiniApp=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,this.app.getAdapters().getAuthInfo(e)];case 1:return t=n.sent(),[2,this.associateWithAuthData(t.provider,t.authData,e)]}}))}))},t.prototype.dissociateAuthData=function(e){var t;return this.update(((t={})["authData."+e]=G.unset(),t),{fetch:!0})},t.prototype.signUp=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:if(!this.isAnonymous())throw new Error("User#signUp can only be invoked by an anonymous user");return N(e.username,"The username must be provided"),N(e.password,"The password must be provided"),[4,this.isCurrentAsync()];case 1:return n.sent()&&V.syncCurrentUserAsync(this.app,(function(e){delete e.authData.anonymous})),[2,this.update(e,t)]}}))}))},t.prototype.refreshSessionToken=function(e){return o(this,void 0,void 0,(function(){var t,n=this;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/users/"+this.objectId+"/refreshSessionToken",options:r(r({},e),{sessionToken:this.sessionToken})})];case 1:return t=o.sent(),this.data.sessionToken=t.body.sessionToken,[4,this.isCurrentAsync()];case 2:return o.sent()?[4,V.syncCurrentUserAsync(this.app,(function(e){e.sessionToken=n.sessionToken}))]:[3,4];case 3:o.sent(),o.label=4;case 4:return[2]}}))}))},t.prototype.follow=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(o){switch(o.label){case 0:return N(this.sessionToken,"Cannot create friendship for an unauthorized user"),n="string"==typeof e?e:e.objectId,[4,this.app.request({method:"POST",path:"1.1/users/"+this.objectId+"/friendship/"+n,body:null==t?void 0:t.data,options:r(r({},t),{sessionToken:this.sessionToken})})];case 1:return o.sent(),[2]}}))}))},t.prototype.unfollow=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(o){switch(o.label){case 0:return N(this.sessionToken,"Cannot remove friendship for an unauthorized user"),n="string"==typeof e?e:e.objectId,[4,this.app.request({method:"DELETE",path:"1.1/users/"+this.objectId+"/friendship/"+n,options:r(r({},t),{sessionToken:this.sessionToken})})];case 1:return o.sent(),[2]}}))}))},t.prototype.getRoles=function(){return this._ref.getRoles()},t.prototype.get=function(e){return this._ref.get(r({sessionToken:this.sessionToken},e))},t.prototype.update=function(e,t){return this._ref.update(e,r({sessionToken:this.sessionToken},t))},t.prototype.delete=function(e){return this._ref.delete(r({sessionToken:this.sessionToken},e))},t}(E),H="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),Y=new Uint8Array(16);function ee(){if(!H)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return H(Y)}var te=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function ne(e){return"string"==typeof e&&te.test(e)}for(var re=[],oe=0;oe<256;++oe)re.push((oe+256).toString(16).substr(1));function ie(e,t,n){var r=(e=e||{}).random||(e.rng||ee)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(re[e[t+0]]+re[e[t+1]]+re[e[t+2]]+re[e[t+3]]+"-"+re[e[t+4]]+re[e[t+5]]+"-"+re[e[t+6]]+re[e[t+7]]+"-"+re[e[t+8]]+re[e[t+9]]+"-"+re[e[t+10]]+re[e[t+11]]+re[e[t+12]]+re[e[t+13]]+re[e[t+14]]+re[e[t+15]]).toLowerCase();if(!ne(n))throw TypeError("Stringified UUID is invalid");return n}(r)}var se=function(e){function t(t){return e.call(this,t,"_User")||this}return n(t,e),t.prototype.object=function(e){return new X(this.app,e)},t.prototype.current=function(){return V.getCurrentUser(this.app)},t.prototype.currentAsync=function(){return V.getCurrentUserAsync(this.app)},t.prototype.become=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({path:"1.1/users/me",options:r(r({},t),{sessionToken:e})})];case 1:return n=o.sent(),[2,this._decodeAndSetToCurrent(n.body)]}}))}))},t.prototype.signUp=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/users",body:U(e),options:t})];case 1:return n=r.sent(),[2,this._decodeAndSetToCurrent(n.body)]}}))}))},t.prototype.signUpOrLoginWithMobilePhone=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/usersByMobilePhone",body:U(e),options:t})];case 1:return n=r.sent(),[2,this._decodeAndSetToCurrent(n.body)]}}))}))},t.prototype.logInWithData=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/login",body:U(e),options:t})];case 1:return n=r.sent(),[2,this._decodeAndSetToCurrent(n.body)]}}))}))},t.prototype.logIn=function(e,t,n){return this.logInWithData({username:e,password:t},n)},t.prototype.logInWithAuthData=function(e,t,n){return o(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/users",body:{authData:(o={},o[e]=t,o)},query:{failOnNotExist:null==n?void 0:n.failOnNotExist},options:n})];case 1:return r=i.sent(),[2,this._decodeAndSetToCurrent(r.body)]}}))}))},t.prototype.logInAnonymously=function(e){return this.logInWithAuthData("anonymous",{id:ie()},e)},t.prototype.logInWithEmail=function(e,t,n){return this.logInWithData({email:e,password:t},n)},t.prototype.logInWithMobilePhone=function(e,t,n){return this.logInWithData({mobilePhoneNumber:e,password:t},n)},t.prototype.logInWithMobilePhoneSMSCode=function(e,t,n){return this.logInWithData({mobilePhoneNumber:e,smsCode:t},n)},t.prototype.logInWithAuthDataAndUnionId=function(e,t,n,r){return t=Object.assign({},t,{platform:null==r?void 0:r.unionIdPlatform,main_account:null==r?void 0:r.asMainAccount,unionid:n}),this.logInWithAuthData(e,t,r)},t.prototype.logInWithMiniApp=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,this.app.getAdapters().getAuthInfo(e)];case 1:return t=n.sent(),[2,this.logInWithAuthData(t.provider,t.authData,e)]}}))}))},t.prototype.logOut=function(){V.removeCurrentUser(this.app)},t.prototype.logOutAsync=function(){return V.removeCurrentUserAsync(this.app)},t.prototype.requestEmailVerify=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestEmailVerify",body:{email:e},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.requestLoginSMSCode=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestLoginSmsCode",body:{mobilePhoneNumber:e,validate_token:null==t?void 0:t.validateToken},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.requestMobilePhoneVerify=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestMobilePhoneVerify",body:{mobilePhoneNumber:e,validate_token:null==t?void 0:t.validateToken},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.requestPasswordReset=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestPasswordReset",body:{email:e},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.requestPasswordResetBySMSCode=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestPasswordResetBySmsCode",body:{mobilePhoneNumber:e,validate_token:null==t?void 0:t.validateToken},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.resetPasswordBySMSCode=function(e,t,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/resetPasswordBySmsCode/"+e,body:{password:t},options:n})];case 1:return r.sent(),[2]}}))}))},t.prototype.verifyMobilePhone=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/verifyMobilePhone/"+e,options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.requestChangePhoneNumber=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestChangePhoneNumber",body:{mobilePhoneNumber:e,ttl:null==t?void 0:t.ttl},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.changePhoneNumber=function(e,t,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/changePhoneNumber",body:{mobilePhoneNumber:e,code:t},options:n})];case 1:return r.sent(),[2]}}))}))},t.prototype._decodeAndSetToCurrent=function(e){var t=this.app.decode(e,this.className);return V.setCurrentUser(this.app,t),t},t}(z);F.setCreator("_Role",(function(e,t){return new ae(e,t)}));var ue=function(e){function t(t,n){return e.call(this,t,"_Role",n)||this}return n(t,e),t.prototype.addUser=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/roles/"+this.objectId,body:{users:G.addRelation(e)},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.addRole=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/roles/"+this.objectId,body:{roles:G.addRelation(e)},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.removeUser=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/roles/"+this.objectId,body:{users:G.removeRelation(e)},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.removeRole=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/roles/"+this.objectId,body:{roles:G.removeRelation(e)},options:t})];case 1:return n.sent(),[2]}}))}))},t.prototype.getUsersQuery=function(){return new $(this.app,"_User").where("$relatedTo","==",{object:this,key:"users"})},t.prototype.getRolesQuery=function(){return new $(this.app,"_Role").where("$relatedTo","==",{object:this,key:"roles"})},t.prototype.getUsers=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.getUsersQuery().find(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.getRoles=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.getRolesQuery().find(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.get=function(t){return e.prototype.get.call(this,t)},t.prototype.update=function(t,n){return e.prototype.update.call(this,t,n)},t}(x),ae=function(e){function t(t,n){var r=e.call(this,t,"_Role",n)||this;return r._ref=new ue(t,n),r}return n(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return this.data.name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ACLKey",{get:function(){return"role:"+this.data.name},enumerable:!1,configurable:!0}),t.prototype.addUser=function(e,t){return this._ref.addUser(e,t)},t.prototype.addRole=function(e,t){return this._ref.addRole(e,t)},t.prototype.removeUser=function(e,t){return this._ref.removeUser(e,t)},t.prototype.removeRole=function(e,t){return this._ref.removeRole(e,t)},t.prototype.getUsersQuery=function(){return this._ref.getUsersQuery()},t.prototype.getRolesQuery=function(){return this._ref.getRolesQuery()},t.prototype.getUsers=function(e){return this._ref.getUsers(e)},t.prototype.getRoles=function(e){return this._ref.getRoles(e)},t.prototype.get=function(t){return e.prototype.get.call(this,t)},t.prototype.update=function(t,n){return e.prototype.update.call(this,t,n)},t}(E),ce=function(e){function t(t){return e.call(this,t,"_Role")||this}return n(t,e),t.prototype.object=function(e){return new ue(this.app,e)},t.prototype.add=function(e,t){return o(this,void 0,void 0,(function(){var n,o;return i(this,(function(i){switch(i.label){case 0:return n=r({},e),e.roles&&(n.roles=G.addRelation(e.roles)),e.users&&(n.users=G.addRelation(e.users)),[4,this.app.request({method:"POST",path:"1.1/roles",body:n,options:t})];case 1:return o=i.sent(),[2,this.app.decode(o.body,this.className)]}}))}))},t}(z),he=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.sendToFollowers=function(e,t,n){return o(this,void 0,void 0,(function(){var o;return i(this,(function(i){switch(i.label){case 0:return N(e.sessionToken,"Cannot create status for an unauthorized user"),[4,this.app.request({method:"POST",path:"1.1/statuses",query:{fetchWhenSave:!0},body:{query:{className:"_Follower",keys:"follower",where:{user:e.toPointer()}},data:r({source:e.toPointer()},t),inboxType:null==n?void 0:n.inboxType},options:r({sessionToken:e.sessionToken},n)})];case 1:return o=i.sent(),[2,F.decodeObject(this.app,o.body,"_Status")]}}))}))},t.prototype.sendToUser=function(e,t,n,s){return o(this,void 0,void 0,(function(){var o,u;return i(this,(function(i){switch(i.label){case 0:return N(e.sessionToken,"Cannot create status for an unauthorized user"),o="string"==typeof t?t:t.objectId,[4,this.app.request({method:"POST",path:"1.1/statuses",body:{query:{className:"_User",where:{objectId:o}},data:r({source:e.toPointer()},n),inboxType:(null==s?void 0:s.inboxType)||"private"},options:r({sessionToken:e.sessionToken},s)})];case 1:return u=i.sent(),[2,F.decodeObject(this.app,u.body,"_Status")]}}))}))},t.prototype.deleteInboxStatus=function(e,t,n){return o(this,void 0,void 0,(function(){return i(this,(function(o){switch(o.label){case 0:return N(e.sessionToken,"Cannot remove status for an unauthorized user"),[4,this.app.request({method:"DELETE",path:"1.1/subscribe/statuses/inbox",query:{owner:JSON.stringify(e.toPointer()),inboxType:null==n?void 0:n.inboxType,messageId:t},options:r({sessionToken:e.sessionToken},n)})];case 1:return o.sent(),[2]}}))}))},t.prototype.getUnreadCount=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return N(e.sessionToken,"Cannot get unread status count for an unauthorized user"),[4,this.app.request({method:"GET",path:"1.1/subscribe/statuses/count",query:{owner:JSON.stringify(e.toPointer()),inboxType:null==t?void 0:t.inboxType},options:r({sessionToken:e.sessionToken},t)})];case 1:return[2,n.sent().body]}}))}))},t.prototype.resetUnreadCount=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return N(e.sessionToken,"Cannot reset unread count for an unauthorized user"),[4,this.app.request({method:"POST",path:"1.1/subscribe/statuses/resetUnreadCount",query:{owner:JSON.stringify(e.toPointer()),inboxType:null==t?void 0:t.inboxType},options:r({sessionToken:e.sessionToken},t)})];case 1:return n.sent(),[2]}}))}))},t}(function(e){function t(t){return e.call(this,t,"_Status")||this}return n(t,e),t.prototype.whereStatusOwner=function(e){var t=this._clone();return t._statusOwner="string"==typeof e?{__type:"Pointer",className:"_User",objectId:e}:e.toPointer(),t._whereEqualTo("source",t._statusOwner),t},t.prototype.whereInboxOwner=function(e){N(e.sessionToken,"Cannot query inbox for an unauthorized user");var t=this._clone();return t._inboxOwner=e,t},t.prototype.whereInboxType=function(e){var t=this._clone();return t._inboxType=e,t},t.prototype.whereSinceId=function(e){var t=this._clone();return t._sinceId=e,t},t.prototype.whereMaxId=function(e){var t=this._clone();return t._maxId=e,t},t.prototype._clone=function(n){return n||(n=new t(this.app)),(n=e.prototype._clone.call(this,n))._statusOwner=this._statusOwner,n._inboxOwner=this._inboxOwner,n._inboxType=this._inboxType,n._sinceId=this._sinceId,n._maxId=this._maxId,n},t.prototype._makeRequest=function(t){var n=e.prototype._makeRequest.call(this,t);return this._inboxOwner&&(N(void 0===this._statusOwner,"Cannot query both inboxOwner and statusOwner"),n.path="1.1/subscribe/statuses",n.options?n.options.sessionToken||(n.options.sessionToken=this._inboxOwner.sessionToken):n.options={sessionToken:this._inboxOwner.sessionToken},n.query.owner=JSON.stringify(this._inboxOwner.toPointer()),n.query.inboxType=this._inboxType,n.query.sinceId=this._sinceId,n.query.maxId=this._maxId),n},t}($)),de=c((function(e,t){!function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<e.length;r++)n[e.charCodeAt(r)]=r;t.encode=function(t){var n,r=new Uint8Array(t),o=r.length,i="";for(n=0;n<o;n+=3)i+=e[r[n]>>2],i+=e[(3&r[n])<<4|r[n+1]>>4],i+=e[(15&r[n+1])<<2|r[n+2]>>6],i+=e[63&r[n+2]];return o%3==2?i=i.substring(0,i.length-1)+"=":o%3==1&&(i=i.substring(0,i.length-2)+"=="),i},t.decode=function(e){var t,r,o,i,s,u=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(u--,"="===e[e.length-2]&&u--);var h=new ArrayBuffer(u),d=new Uint8Array(h);for(t=0;t<a;t+=4)r=n[e.charCodeAt(t)],o=n[e.charCodeAt(t+1)],i=n[e.charCodeAt(t+2)],s=n[e.charCodeAt(t+3)],d[c++]=r<<2|o>>4,d[c++]=(15&o)<<4|i>>2,d[c++]=(3&i)<<6|63&s;return h}}()})),pe=function(){function e(){}return e.prototype.upload=function(e,t,n,s){return function(e,t){return o(this,void 0,void 0,(function(){var n,o,s,u;return i(this,(function(i){switch(i.label){case 0:return n=a().upload,o=k(e),g.log("LC:Upload:send","%O",e),u=A,[4,n(o,t,r(r({},e.options),{method:e.method||"POST",headers:e.header,data:e.form}))];case 1:return s=u.apply(void 0,[i.sent()]),g.log("LC:Upload:recv","%O",s),[2,s]}}))}))}({method:"POST",header:null==s?void 0:s.header,baseURL:n.upload_url,form:{name:e,key:n.key,token:n.token},options:s},{field:"file",name:e,data:t})},e}(),le=function(){function e(e){this.app=e}return e.prototype.upload=function(e,t,n,o){return this.app.request({method:"PUT",baseURL:n.upload_url,header:r({"Content-Type":n.mime_type,"Cache-Control":"public, max-age=31536000"},null==o?void 0:o.header),body:t,options:o})},e}();F.setCreator("_File",(function(e,t){return new ye(e,t)}));var fe=function(e){function t(t,n){return e.call(this,t,"_File",n)||this}return n(t,e),t.prototype.get=function(t){return e.prototype.get.call(this,t)},t.prototype.update=function(t,n){return e.prototype.update.call(this,{name:t.name,url:t.url,mime_type:t.mime_type,metaData:t.metaData,ACL:t.ACL},n)},t}(x),ye=function(e){function t(t,n){var r=e.call(this,t,"_File",n)||this;return r._ref=new fe(t,n),r}return n(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return this.data.name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this.data.url},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){var e;return null===(e=this.data.metaData)||void 0===e?void 0:e.size},enumerable:!1,configurable:!0}),t.prototype.thumbnailURL=function(e,t,n,r,o){void 0===n&&(n=100),void 0===r&&(r=!0),void 0===o&&(o="png");var i=r?2:1;return this.url+"?imageView/"+i+"/w/"+e+"/h/"+t+"/q/"+n+"/format/"+o},t.prototype.get=function(e){return this._ref.get(e)},t.prototype.update=function(e,t){return this._ref.update(e,t)},t}(E),ve=function(e){function t(t){return e.call(this,t,"_File")||this}return n(t,e),t.prototype.object=function(e){return new fe(this.app,e)},t.prototype.upload=function(e,t,n){return o(this,void 0,void 0,(function(){var o,s,u,a,c,h;return i(this,(function(i){switch(i.label){case 0:return t=this._parseFileData(t),o=r(r({},null==n?void 0:n.metaData),{size:this._getFileSize(t)}),(null==n?void 0:n.sessionToken)?(o.owner=n.sessionToken,[3,3]):[3,1];case 1:return s=o,[4,this.app.getSessionTokenAsync()];case 2:s.owner=i.sent(),i.label=3;case 3:return o.owner||(o.owner="unknown"),[4,this._getFileTokens(e,null==n?void 0:n.mime,null==n?void 0:n.ACL,o)];case 4:u=i.sent(),a=this._getFileProvider(u.provider),i.label=5;case 5:return i.trys.push([5,8,,10]),[4,a.upload(e,t,u,n)];case 6:return i.sent(),[4,this._invokeFileCallback(u.token,!0)];case 7:return i.sent(),[3,10];case 8:return c=i.sent(),[4,this._invokeFileCallback(u.token,!1)];case 9:throw i.sent(),c;case 10:return(h=new ye(this.app,u.objectId)).data=r(r({},u),{name:e,metaData:o}),h.createdAt=new Date(u.createdAt),h.updatedAt=h.createdAt,delete h.data.createdAt,[2,h]}}))}))},t.prototype.uploadWithURL=function(e,t,n){return o(this,void 0,void 0,(function(){var o,s,u,a;return i(this,(function(i){switch(i.label){case 0:return o=r(r({},null==n?void 0:n.metaData),{__source:"external"}),(null==n?void 0:n.sessionToken)?(o.owner=n.sessionToken,[3,3]):[3,1];case 1:return s=o,[4,this.app.getSessionTokenAsync()];case 2:s.owner=i.sent(),i.label=3;case 3:return o.owner||(o.owner="unknown"),[4,this.app.request({method:"POST",path:"1.1/files/"+e,body:{name:e,url:t,ACL:null==n?void 0:n.ACL,mime_type:null==n?void 0:n.mime,metaData:o}})];case 4:return u=i.sent(),(a=new ye(this.app,u.body.objectId)).data=r(r({},u.body),{metaData:o}),a.createdAt=new Date(a.data.createdAt),a.updatedAt=a.createdAt,delete a.data.createdAt,[2,a]}}))}))},t.prototype._parseFileData=function(e){if(Array.isArray(e)){var t=new Uint8Array(e.length);if(e.forEach((function(e,n){return t[n]=e})),"undefined"!=typeof Blob)return new Blob([t]);if("undefined"!=typeof Buffer)return Buffer.from(t);throw new Error("Current platform cannot upload byte array encoded file")}if(e.base64){var n=e.base64;if("undefined"!=typeof Blob)return new Blob([de.decode(n)]);if("undefined"!=typeof Buffer)return Buffer.from(n,"base64");throw new Error("Current platform cannot upload base64 encoded file")}return e.blob?e.blob:e},t.prototype._getFileSize=function(e){return"undefined"!=typeof Blob&&e instanceof Blob?e.size:"undefined"!=typeof Buffer&&Buffer.isBuffer(e)?e.length:void 0},t.prototype._getFileTokens=function(e,t,n,r){return o(this,void 0,void 0,(function(){return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/fileTokens",body:{name:e,ACL:n,metaData:r,mime_type:t}})];case 1:return[2,o.sent().body]}}))}))},t.prototype._getFileProvider=function(e){switch(e){case"qiniu":return new pe;case"s3":return new le(this.app);default:throw new Error("Unsupported file provider: "+e)}},t.prototype._invokeFileCallback=function(e,t){return this.app.request({method:"POST",path:"1.1/fileCallback",body:{token:e,result:t}})},t}(z),be=function(){function e(e){this.app=e}return e.prototype.class=function(e){switch(e){case"_User":return new se(this.app);case"_Role":return new ce(this.app);case"_Status":return new he(this.app);case"_File":return new ve(this.app);default:return new z(this.app,e)}},e.prototype.encode=function(e){return F.encodeObject(e,!0)},e.prototype.decode=function(e){var t=this.app.decode(e);return N(t instanceof E,"Decode failed"),t},e}(),me=function(){function e(e,t){var n,r=this;this._app=e,this.sid=t.sid,this.hits=t.hits,this.results=null===(n=t.results)||void 0===n?void 0:n.map((function(e){return r._app.decodeObject(e)}))}return e.prototype.next=function(t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return 0===this.results.length?[2,this]:[4,this._app.request({method:"GET",path:"1.1/search/select",query:{sid:this.sid},options:t})];case 1:return n=r.sent(),[2,new e(this._app,n.body)]}}))}))},e}(),_e=function(){function e(){this._sortFields=[]}return e.prototype.orderBy=function(e,t,n){var r,o={order:t};return(null==n?void 0:n.mode)&&(o.mode=n.mode),(null==n?void 0:n.missing)&&(o.missing="_"+n.missing),this._sortFields.push(((r={})[e]=o,r)),this},e.prototype.whereNear=function(e,t,n){var o,i=r(r({},n),((o={})[e]={lat:t.latitude,lon:t.longitude},o));return this._sortFields.push({_geo_distance:i}),this},e.prototype.toString=function(){return JSON.stringify(this._sortFields)},e}(),ge=function(){function e(e,t){this.app=e,this.className=t,this._order=[]}return e.prototype.queryString=function(e){var t=this._clone();return t._q=e,t},e.prototype.skip=function(e){var t=this._clone();return t._skip=e,t},e.prototype.limit=function(e){var t=this._clone();return t._limit=e,t},e.prototype.sid=function(e){var t=this._clone();return t._sid=e,t},e.prototype.fields=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._clone();return n._fields=e,n},e.prototype.highlights=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._clone();return n._highlights=e,n},e.prototype.include=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._clone();return n._include=e,n},e.prototype.find=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request(this._makeRequest(e))];case 1:return t=n.sent(),[2,new me(this.app,t.body)]}}))}))},e.prototype.orderBy=function(e,t){var n=this._clone();return"desc"===t?n._order.push("-"+e):n._order.push(e),n},e.prototype.sortBy=function(e){var t=this._clone();return t._sort=e.toString(),t},e.prototype._makeRequest=function(e){var t,n={method:"GET",path:"1.1/search/select",query:{q:this._q,skip:this._skip,limit:this._limit,sid:this._sid,clazz:this.className,sort:this._sort},options:e};return this._fields&&(n.query.fields=this._fields.join(",")),this._highlights&&(n.query.highlights=this._highlights.join(",")),this._include&&(n.query.include=this._include.join(",")),this._order.length&&(n.query.order=null===(t=this._order)||void 0===t?void 0:t.join(",")),n},e.prototype._clone=function(){var t=new e(this.app,this.className);return t._q=this._q,t._skip=this._skip,t._limit=this._limit,t._sid=this._sid,t._fields=this._fields,t._highlights=this._highlights,t._sort=this._sort,t._include=this._include,t._order=s(this._order),t},e}(),we=function(){function e(e){this.app=e}return e.request=function(t,n){return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,(r=new e(t)).refresh(n)];case 1:return o.sent(),[2,r]}}))}))},e.prototype.refresh=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return this.validateToken=null,[4,this.app.request({method:"GET",path:"1.1/requestCaptcha",query:{width:null==e?void 0:e.width,height:null==e?void 0:e.height,size:null==e?void 0:e.size,ttl:null==e?void 0:e.ttl},options:e})];case 1:return t=n.sent(),this.token=t.body.captcha_token,this.url=t.body.captcha_url,[2]}}))}))},e.prototype.verify=function(e,t){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:if(!this.token)throw new Error("The captcha token is empty, you should call refresh first");return[4,this.app.request({method:"POST",path:"1.1/verifyCaptcha",body:{captcha_code:e,captcha_token:this.token},options:t})];case 1:return n=r.sent(),this.validateToken=n.body.validate_token,[2,this.validateToken]}}))}))},e.prototype.bind=function(e){this._binder||(this._binder=new Ce(this,e)),this._binder.bind()},e.prototype.unbind=function(){this._binder&&this._binder.unbind()},e}(),Ce=function(){function e(e,t){this.captcha=e,"string"==typeof t.image?this.image=document.getElementById(t.image):this.image=t.image,"string"==typeof t.textInput?this.input=document.getElementById(t.textInput):this.input=t.textInput,"string"==typeof t.verifyButton?this.button=document.getElementById(t.verifyButton):this.button=t.verifyButton,this.onSuccess=t.success,this.onError=t.error,this.onRefresh=this.refresh.bind(this),this.onVerify=this.verify.bind(this)}return e.prototype.refresh=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.captcha.refresh()];case 1:return t.sent(),this.image.src=this.captcha.url,this.input&&(this.input.value="",this.input.focus()),[3,3];case 2:return e=t.sent(),this.onError&&this.onError(e),[3,3];case 3:return[2]}}))}))},e.prototype.verify=function(){return o(this,void 0,void 0,(function(){var e,t;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),e=this.input.value,[4,this.captcha.verify(e)];case 1:return n.sent(),this.onSuccess&&this.onSuccess(this.captcha.validateToken),[3,3];case 2:return t=n.sent(),this.onError&&this.onError(t),[3,3];case 3:return[2]}}))}))},e.prototype.bind=function(){this.image&&(this.image.src=this.captcha.url,this.image.addEventListener("click",this.onRefresh)),this.input&&this.button&&this.button.addEventListener("click",this.onVerify)},e.prototype.unbind=function(){this.image&&this.image.removeEventListener("click",this.onRefresh),this.button&&this.button.removeEventListener("click",this.onVerify)},e}(),ke=function(){function e(e){this.app=e}return e.prototype.requestSMSCode=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestSmsCode",body:r(r({},null==t?void 0:t.variables),{mobilePhoneNumber:e,smsType:null==t?void 0:t.smsType,ttl:null==t?void 0:t.ttl,name:null==t?void 0:t.name,op:null==t?void 0:t.op,template:null==t?void 0:t.template,sign:null==t?void 0:t.sign,validate_token:null==t?void 0:t.validateToken}),options:t})];case 1:return n.sent(),[2]}}))}))},e.prototype.verifySMSCode=function(e,t,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/verifySmsCode/"+t,body:{mobilePhoneNumber:e},options:n})];case 1:return r.sent(),[2]}}))}))},e.prototype.run=function(e,t,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/functions/"+e,body:t,options:n})];case 1:return[2,r.sent().body.result]}}))}))},e.prototype.rpc=function(e,t,n){return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/call/"+e,body:F.encode(t,!0),options:n})];case 1:return r=o.sent(),[2,this.app.decode(r.body.result)]}}))}))},e}(),Ae=function(){function e(e){this.app=e}return e.prototype.send=function(e,t){var n,r,s;return o(this,void 0,void 0,(function(){return i(this,(function(o){switch(o.label){case 0:if((null==t?void 0:t.expirationTime)&&(null==t?void 0:t.expirationInterval))throw new Error("Both expirationTime and expirationInterval cannot be set");return[4,this.app.request({method:"POST",path:"1.1/push",body:{data:e,where:null===(n=null==t?void 0:t.query)||void 0===n?void 0:n.toJSON(),channels:null==t?void 0:t.channels,push_time:null===(r=null==t?void 0:t.pushTime)||void 0===r?void 0:r.toISOString(),expiration_time:null===(s=null==t?void 0:t.expirationTime)||void 0===s?void 0:s.toISOString(),expiration_interval:null==t?void 0:t.expirationInterval,notification_id:null==t?void 0:t.notificationId,req_id:null==t?void 0:t.reqId,prod:null==t?void 0:t.prod,topic:null==t?void 0:t.topic,apns_team_id:null==t?void 0:t.apnsTeamId,flow_control:null==t?void 0:t.flowControl,_notificationChannel:null==t?void 0:t.notificationChannel},options:t})];case 1:return o.sent(),[2]}}))}))},e}();e.ACL=P,e.App=D,e.Captcha=we,e.Cloud=ke,e.GeoPoint=M,e.Op=G,e.Push=Ae,e.Query=$,e.SearchQuery=ge,e.SearchSortBuilder=_e,e.Storage=be,e.debug=g,e.setAdapters=function(e){if(u)throw new Error("Adapters already set");u=e},e.use=function(e){e.load(D)},Object.defineProperty(e,"__esModule",{value:!0})}));
